<!doctype html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Connexion et sécurisation | Cours de Rémi Jarjat</title><meta name="description" content="Les formations de Rémi Jarjat pour Human Booster">
    <link rel="preload" href="/cours/assets/style-BEIxaUV1.css" as="style"><link rel="stylesheet" href="/cours/assets/style-BEIxaUV1.css">
    <link rel="modulepreload" href="/cours/assets/app-BkblVdII.js"><link rel="modulepreload" href="/cours/assets/30-user.html-BqWDoicu.js">
    <link rel="prefetch" href="/cours/assets/index.html-DNrA6HK6.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-CXP878eB.js" as="script"><link rel="prefetch" href="/cours/assets/00-intro.html-Bk8UQcqp.js" as="script"><link rel="prefetch" href="/cours/assets/05-ftp.html-E0Ur07Av.js" as="script"><link rel="prefetch" href="/cours/assets/10-wordpress.html-7q_yRW6f.js" as="script"><link rel="prefetch" href="/cours/assets/20-git.html-ID_OUtqT.js" as="script"><link rel="prefetch" href="/cours/assets/21-github-pages.html-BgRPfY28.js" as="script"><link rel="prefetch" href="/cours/assets/30-symfony-angular.html-ChdxRAKi.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-DYPvKtbL.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-D32X3tpQ.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-BB_fAsgA.js" as="script"><link rel="prefetch" href="/cours/assets/0-terminologie.html-DGfn3tkH.js" as="script"><link rel="prefetch" href="/cours/assets/1-before_start.html-C8oSeMYR.js" as="script"><link rel="prefetch" href="/cours/assets/2-init_local.html-CJ1oLmNZ.js" as="script"><link rel="prefetch" href="/cours/assets/3-record_changes.html-mTq4a0nY.js" as="script"><link rel="prefetch" href="/cours/assets/4-branches.html-CcALPmAX.js" as="script"><link rel="prefetch" href="/cours/assets/5-common-work.html-BuKBh4ba.js" as="script"><link rel="prefetch" href="/cours/assets/6-rollback.html-DCW2n4gz.js" as="script"><link rel="prefetch" href="/cours/assets/7-rewrite-history.html-CMox542w.js" as="script"><link rel="prefetch" href="/cours/assets/8-tools.html-dbbGRguW.js" as="script"><link rel="prefetch" href="/cours/assets/98-exercices.html-BdTaL4hu.js" as="script"><link rel="prefetch" href="/cours/assets/99-examples.html-C_ldXykC.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-kzVuneS9.js" as="script"><link rel="prefetch" href="/cours/assets/1-bases.html-CGEYN-2D.js" as="script"><link rel="prefetch" href="/cours/assets/2-logique.html-61J_sYJu.js" as="script"><link rel="prefetch" href="/cours/assets/3-dom.html-BRsCseWv.js" as="script"><link rel="prefetch" href="/cours/assets/4-jquery.html-BToUe5Mr.js" as="script"><link rel="prefetch" href="/cours/assets/5-ajax.html-B4q0yYBG.js" as="script"><link rel="prefetch" href="/cours/assets/6-poo.html-DwJiHe1p.js" as="script"><link rel="prefetch" href="/cours/assets/90-webpack.html-DFKynxKS.js" as="script"><link rel="prefetch" href="/cours/assets/98-outils.html-dtYJRMDJ.js" as="script"><link rel="prefetch" href="/cours/assets/99-revisions.html-DPkBzUUG.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-538Evebu.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-DQl6xswL.js" as="script"><link rel="prefetch" href="/cours/assets/0-install.html-DLL9VTcs.js" as="script"><link rel="prefetch" href="/cours/assets/1-historique.html-DUZ9QH8s.js" as="script"><link rel="prefetch" href="/cours/assets/2-dossiers.html-C8OBAZKb.js" as="script"><link rel="prefetch" href="/cours/assets/3-processus.html-DkBAb6HO.js" as="script"><link rel="prefetch" href="/cours/assets/4-bases.html-BRpP6Qoh.js" as="script"><link rel="prefetch" href="/cours/assets/5-advanced.html-Z6iglftC.js" as="script"><link rel="prefetch" href="/cours/assets/6-other-technologies.html-BPMMqcd8.js" as="script"><link rel="prefetch" href="/cours/assets/98-exercices.html-DdGSvc_3.js" as="script"><link rel="prefetch" href="/cours/assets/99-corrections.html-B9a9jG4k.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-CJUpZt3J.js" as="script"><link rel="prefetch" href="/cours/assets/00-environnement.html-eHcCWfO4.js" as="script"><link rel="prefetch" href="/cours/assets/01-bases.html-CEP22wx2.js" as="script"><link rel="prefetch" href="/cours/assets/02-tests-et-boucles.html-BJvaq02O.js" as="script"><link rel="prefetch" href="/cours/assets/03-fonctions.html-CySeJIXt.js" as="script"><link rel="prefetch" href="/cours/assets/04-user.html-BbC9tlnp.js" as="script"><link rel="prefetch" href="/cours/assets/05-temporisation-de-sortie.html-BprGTVyS.js" as="script"><link rel="prefetch" href="/cours/assets/10-doc.html-hbsDLq8X.js" as="script"><link rel="prefetch" href="/cours/assets/20-objet.html-tavW-9t-.js" as="script"><link rel="prefetch" href="/cours/assets/21-heritage.html-eZii40nq.js" as="script"><link rel="prefetch" href="/cours/assets/22-factorize.html-C_3OxGkX.js" as="script"><link rel="prefetch" href="/cours/assets/30-pdo.html-DZNmK1yi.js" as="script"><link rel="prefetch" href="/cours/assets/40-mvc.html-B7wW4tol.js" as="script"><link rel="prefetch" href="/cours/assets/50-rest.html-DA9kZAyq.js" as="script"><link rel="prefetch" href="/cours/assets/80-bases.html-DxX1aKvt.js" as="script"><link rel="prefetch" href="/cours/assets/81-multiple-files.html-DWDgT5CY.js" as="script"><link rel="prefetch" href="/cours/assets/82-post-session.html-CzHm_mUI.js" as="script"><link rel="prefetch" href="/cours/assets/83-cart-get-session.html-JZBhpCAK.js" as="script"><link rel="prefetch" href="/cours/assets/84-objects.html-CBCLsk4Q.js" as="script"><link rel="prefetch" href="/cours/assets/85-bdd-pdo.html-DLNT2Shx.js" as="script"><link rel="prefetch" href="/cours/assets/91-computer-preparation.html-04nylJYm.js" as="script"><link rel="prefetch" href="/cours/assets/92-jdr.html-PmXnWOug.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-BCpYffRo.js" as="script"><link rel="prefetch" href="/cours/assets/01-installation.html-zMXAMdp5.js" as="script"><link rel="prefetch" href="/cours/assets/10-structure.html-BqkOypUB.js" as="script"><link rel="prefetch" href="/cours/assets/20-routing.html-DEmbotUh.js" as="script"><link rel="prefetch" href="/cours/assets/21-controllers.html-Dw-shP-A.js" as="script"><link rel="prefetch" href="/cours/assets/22-twig.html-BtHhS6Zz.js" as="script"><link rel="prefetch" href="/cours/assets/23-injection.html-FYyHm-3g.js" as="script"><link rel="prefetch" href="/cours/assets/24-doctrine.html-Dy9mTQaU.js" as="script"><link rel="prefetch" href="/cours/assets/25-formulaires.html-ClWG20Ye.js" as="script"><link rel="prefetch" href="/cours/assets/26-translation.html-Bx0CL1gK.js" as="script"><link rel="prefetch" href="/cours/assets/27-event-listeners.html-Cbzkc52t.js" as="script"><link rel="prefetch" href="/cours/assets/40-bundles.html-CcDr5e5S.js" as="script"><link rel="prefetch" href="/cours/assets/41-easy-admin.html-D4Tpj4o2.js" as="script"><link rel="prefetch" href="/cours/assets/42-api-platform.html-BFrCkmar.js" as="script"><link rel="prefetch" href="/cours/assets/80-cheat-sheet.html-CqetZgPG.js" as="script"><link rel="prefetch" href="/cours/assets/81-quotidien.html-3aoij3Mw.js" as="script"><link rel="prefetch" href="/cours/assets/82-docker.html-DANOmWA1.js" as="script"><link rel="prefetch" href="/cours/assets/90-doggies.html-CF6BnQw2.js" as="script"><link rel="prefetch" href="/cours/assets/99-exercices.html-Hfy05qP_.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-Cky5vnQE.js" as="script"><link rel="prefetch" href="/cours/assets/404.html-BBk7B_gA.js" as="script"><link rel="prefetch" href="/cours/assets/mermaid.esm.min-DlybqT7H.js" as="script"><link rel="prefetch" href="/cours/assets/prod-C3uXySb1.js" as="script"><link rel="prefetch" href="/cours/assets/prod-C3uXySb1.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-audio-DWxEHD26.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-video-BzoGie0P.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-hls-DfU-v-dq.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-dash-D54rnz3i.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-vimeo-BK2DV3IR.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-krOAtKMi-C3UUF7YD.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-youtube-DYOMeSWP.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-Zc3I7oOd-CA6XwpqT.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-CWDlegKy-CNXmzpVv.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-D0D6ufFF-BTjCMPz2.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-player-default-layout-uAtmJz4O.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-player-ui-3Hy2pYjc.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-QR8zGkwr-hi-wEx3g.js" as="script"><link rel="prefetch" href="/cours/assets/setupDevtools-7MC2TMWH-C80vdosD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/cours/"><img class="vp-site-logo" src="/cours/assets/LogoHB2.png" alt="Cours de Rémi Jarjat"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Cours de Rémi Jarjat</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><!----><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/" aria-label="Liste des cours"><!---->Liste des cours<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/general/" aria-label="Culture numérique"><!---->Culture numérique<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/git/" aria-label="Git"><!---->Git<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/0-terminologie.html" aria-label="Terminologie"><!---->Terminologie<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/1-before_start.html" aria-label="Avant de commencer"><!---->Avant de commencer<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/2-init_local.html" aria-label="Créer un dépôt (local)"><!---->Créer un dépôt (local)<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/3-record_changes.html" aria-label="Enregistrer des changements"><!---->Enregistrer des changements<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/4-branches.html" aria-label="Des branches"><!---->Des branches<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/5-common-work.html" aria-label="Mise en commun du travail"><!---->Mise en commun du travail<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/6-rollback.html" aria-label="Annuler des changements"><!---->Annuler des changements<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/7-rewrite-history.html" aria-label="Réécrire l&#39;historique"><!---->Réécrire l&#39;historique<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/8-tools.html" aria-label="Des outils pour se simplifier Git"><!---->Des outils pour se simplifier Git<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/98-exercices.html" aria-label="Exercices"><!---->Exercices<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/99-examples.html" aria-label="Exemples pratiques"><!---->Exemples pratiques<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/linux/" aria-label="Linux"><!---->Linux<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/0-install.html" aria-label="Installation"><!---->Installation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/1-historique.html" aria-label="Historique"><!---->Historique<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/2-dossiers.html" aria-label="Rangement des fichiers"><!---->Rangement des fichiers<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/3-processus.html" aria-label="Les processus"><!---->Les processus<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/4-bases.html" aria-label="Commandes de base"><!---->Commandes de base<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/5-advanced.html" aria-label="Commandes avancées"><!---->Commandes avancées<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/6-other-technologies.html" aria-label="/linux/6-other-technologies.html"><!---->/linux/6-other-technologies.html<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/98-exercices.html" aria-label="Exercices"><!---->Exercices<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/99-corrections.html" aria-label="Correction des exercices"><!---->Correction des exercices<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/php/" aria-label="PHP"><!---->PHP<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/00-environnement.html" aria-label="Environnement de travail"><!---->Environnement de travail<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/01-bases.html" aria-label="Bases du PHP"><!---->Bases du PHP<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/02-tests-et-boucles.html" aria-label="Tests et boucles"><!---->Tests et boucles<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/03-fonctions.html" aria-label="Procédures et fonctions"><!---->Procédures et fonctions<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/04-user.html" aria-label="Interagir avec l&#39;utilisateur"><!---->Interagir avec l&#39;utilisateur<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/05-temporisation-de-sortie.html" aria-label="La temporisation de sortie"><!---->La temporisation de sortie<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/10-doc.html" aria-label="PHP Doc et PSR"><!---->PHP Doc et PSR<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/20-objet.html" aria-label="PHP Orienté objet"><!---->PHP Orienté objet<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/21-heritage.html" aria-label="Héritage et objets"><!---->Héritage et objets<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/22-factorize.html" aria-label="Factorisation"><!---->Factorisation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/30-pdo.html" aria-label="Manipuler la BdD avec PDO (PHP Data Object)"><!---->Manipuler la BdD avec PDO (PHP Data Object)<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/40-mvc.html" aria-label="Architecture MVC"><!---->Architecture MVC<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/50-rest.html" aria-label="Webservices REST"><!---->Webservices REST<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/80-bases.html" aria-label="Exercices - Bases"><!---->Exercices - Bases<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/81-multiple-files.html" aria-label="Exercices - Séparer en plusieurs fichiers"><!---->Exercices - Séparer en plusieurs fichiers<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/82-post-session.html" aria-label="Exercices - POST et SESSION"><!---->Exercices - POST et SESSION<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/83-cart-get-session.html" aria-label="Exercices - Panier et validation"><!---->Exercices - Panier et validation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/84-objects.html" aria-label="Exercices - Objets"><!---->Exercices - Objets<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/85-bdd-pdo.html" aria-label="Exercices - BdD avec PDO"><!---->Exercices - BdD avec PDO<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/91-computer-preparation.html" aria-label="Projet - montage d&#39;ordinateurs"><!---->Projet - montage d&#39;ordinateurs<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/92-jdr.html" aria-label="Projet - Personnages de Jeux de Rôle"><!---->Projet - Personnages de Jeux de Rôle<!----></a><!----></li><!--]--></ul></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active collapsible" href="/cours/symfony/" aria-label="Symfony"><!---->Symfony<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/01-installation.html" aria-label="Installer Symfony et son environnement de travail"><!---->Installer Symfony et son environnement de travail<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/10-structure.html" aria-label="Structure et utilisation d&#39;un projet"><!---->Structure et utilisation d&#39;un projet<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/20-routing.html" aria-label="Le routing"><!---->Le routing<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/21-controllers.html" aria-label="Les controllers"><!---->Les controllers<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/22-twig.html" aria-label="Twig"><!---->Twig<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/23-injection.html" aria-label="Les services et l&#39;injection de dépendances"><!---->Les services et l&#39;injection de dépendances<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/24-doctrine.html" aria-label="Doctrine et la BdD"><!---->Doctrine et la BdD<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/25-formulaires.html" aria-label="Formulaires"><!---->Formulaires<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/26-translation.html" aria-label="Les traductions"><!---->Les traductions<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/27-event-listeners.html" aria-label="Event listeners/subscribers"><!---->Event listeners/subscribers<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/cours/symfony/30-user.html" aria-label="Connexion et sécurisation"><!---->Connexion et sécurisation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/40-bundles.html" aria-label="Bundles"><!---->Bundles<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/41-easy-admin.html" aria-label="Easy Admin Bundle"><!---->Easy Admin Bundle<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/42-api-platform.html" aria-label="API Platform"><!---->API Platform<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/80-cheat-sheet.html" aria-label="Pense-bêtes"><!---->Pense-bêtes<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/81-quotidien.html" aria-label="Symfony au quotidien"><!---->Symfony au quotidien<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/82-docker.html" aria-label="Travailler avec Docker"><!---->Travailler avec Docker<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/90-doggies.html" aria-label="Projet : annonces de SPA / éleveurs"><!---->Projet : annonces de SPA / éleveurs<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/99-exercices.html" aria-label="Exercices"><!---->Exercices<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/js/" aria-label="Javascript"><!---->Javascript<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/1-bases.html" aria-label="Les bases du langage"><!---->Les bases du langage<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/2-logique.html" aria-label="Manipulation logique"><!---->Manipulation logique<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/3-dom.html" aria-label="Le DOM"><!---->Le DOM<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/4-jquery.html" aria-label="JQuery"><!---->JQuery<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/5-ajax.html" aria-label="Ajax"><!---->Ajax<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/6-poo.html" aria-label="Programmation orientée objet"><!---->Programmation orientée objet<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/90-webpack.html" aria-label="Webpack"><!---->Webpack<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/98-outils.html" aria-label="Outils utiles"><!---->Outils utiles<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/99-revisions.html" aria-label="Révisions"><!---->Révisions<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/lamp/" aria-label="Serveur Lamp"><!---->Serveur Lamp<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/deploy/" aria-label="Déploiement"><!---->Déploiement<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/00-intro.html" aria-label="Des outils et manières de faire"><!---->Des outils et manières de faire<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/05-ftp.html" aria-label="Déploiement par FTP"><!---->Déploiement par FTP<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/10-wordpress.html" aria-label="Wordpress"><!---->Wordpress<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/20-git.html" aria-label="Intégrer Git dans le processus"><!---->Intégrer Git dans le processus<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/21-github-pages.html" aria-label="GitHub Pages pour déployer facilement"><!---->GitHub Pages pour déployer facilement<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/30-symfony-angular.html" aria-label="Symfony et Angular"><!---->Symfony et Angular<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/docker/" aria-label="Docker"><!---->Docker<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/ci/" aria-label="Intégration continue"><!---->Intégration continue<!----></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="connexion-et-securisation" tabindex="-1"><a class="header-anchor" href="#connexion-et-securisation"><span>Connexion et sécurisation</span></a></h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/cours/symfony/30-user.html#pour-resumer" class="router-link-active router-link-exact-active">Pour résumer</a></li><li><a aria-current="page" href="/cours/symfony/30-user.html#installation-et-preparation" class="router-link-active router-link-exact-active">Installation et préparation</a></li><li><a aria-current="page" href="/cours/symfony/30-user.html#configuration" class="router-link-active router-link-exact-active">Configuration</a></li><li><a aria-current="page" href="/cours/symfony/30-user.html#connecter-un-utilisateur" class="router-link-active router-link-exact-active">Connecter un utilisateur</a></li><li><a aria-current="page" href="/cours/symfony/30-user.html#utiliser-les-droits" class="router-link-active router-link-exact-active">Utiliser les droits</a><ul><li><a aria-current="page" href="/cours/symfony/30-user.html#security-yaml" class="router-link-active router-link-exact-active">Security.yaml</a></li><li><a aria-current="page" href="/cours/symfony/30-user.html#isgranted-et-is-granted" class="router-link-active router-link-exact-active">IsGranted() et is_granted()</a></li></ul></li><li><a aria-current="page" href="/cours/symfony/30-user.html#recuperer-le-user-connecte" class="router-link-active router-link-exact-active">Récupérer le User connecté</a><ul><li><a aria-current="page" href="/cours/symfony/30-user.html#dans-un-controleur" class="router-link-active router-link-exact-active">Dans un contrôleur</a></li><li><a aria-current="page" href="/cours/symfony/30-user.html#dans-un-service" class="router-link-active router-link-exact-active">Dans un service</a></li><li><a aria-current="page" href="/cours/symfony/30-user.html#dans-un-template" class="router-link-active router-link-exact-active">Dans un template</a></li></ul></li><li><a aria-current="page" href="/cours/symfony/30-user.html#inscription" class="router-link-active router-link-exact-active">Inscription</a></li><li><a aria-current="page" href="/cours/symfony/30-user.html#gerer-les-droits-avec-les-voters" class="router-link-active router-link-exact-active">Gérer les droits avec les Voters</a></li></ul></nav><p>La <a href="https://symfony.com/doc/current/security.html" target="_blank" rel="noopener noreferrer">documentation officielle</a>, que l&#39;on va suivre / reprendre.</p><p>⚠️ Cette partie a été écrite pour Symfony 5.3 et plusieurs choses ont été modifiées depuis la version 5.2 (le fonctionnement reste le même, mais plusieurs éléments étaient plus complexes). Vous trouverez une <a href="https://www.loom.com/embed/c35c8ab1e4614a4ebf0eeffd0f8fad94" target="_blank" rel="noopener noreferrer">version de présentation de la version 5.2 de Symfony dans cette vidéo</a>.</p><div style="position:relative;padding-bottom:56.25%;height:0;"><iframe src="https://www.loom.com/embed/2539a55e6a2e4d1a9e829b195268377c" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div><h2 id="pour-resumer" tabindex="-1"><a class="header-anchor" href="#pour-resumer"><span>Pour résumer</span></a></h2><ul><li><code>php bin/console make:user</code> pour créer une classe servant à la connexion</li><li><code>php bin/console make:auth</code> pour créer le système de connexion et mettre en place la sécurisation de base</li><li>Mettre à jour l&#39;Authenticator créé, ainsi que la page de connexion</li><li>Pour s&#39;assurer des droits d&#39;un utilisateur, on peut utiliser : <ul><li>L&#39;annotation <code>@IsGranted()</code> (Controllers)</li><li>La fonction <code>is_granted()</code> (Twig)</li><li>La méthode <code>isGranted()</code> du service <code>Symfony\Component\Security\Core\Security</code> (services)</li></ul></li><li>On peut récupérer l&#39;utilisateur connecté avec : <ul><li><code>$this-&gt;getUser()</code> dans un controller étendant <code>AbstractController</code></li><li><code>$this-&gt;security-&gt;getUser()</code> dans un service où le service <code>Security</code> a été injecté</li><li><code>app.user</code> dans une vue Twig</li></ul></li><li><code>php bin/console make:registration-form</code> pour créer automatiquement un formulaire d&#39;inscription</li></ul><h2 id="installation-et-preparation" tabindex="-1"><a class="header-anchor" href="#installation-et-preparation"><span>Installation et préparation</span></a></h2><p>Tout d&#39;abord, installer le bundle nécessaire (il est inclus par défaut, sur les projets initialisés avec <code>--webapp</code>) :</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">composer</span> require symfony/security-bundle</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Il faut alors créer une entité pour gérer les utilisateurs (la plupart du temps, on l&#39;appelle <code>User</code>, mais vous pouvez adapter le nom à votre besoin). On utilise la commande <code>make:user</code> pour générer cette entité particulière.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">php bin/console make:user</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Dans la plupart des cas, nous voulons stocker notre entité <code>User</code> en base (c&#39;est pour cela que je parle d&#39;entité 😉 ), mais sachez que ça n&#39;est pas obligatoire.</p><p>Il faut alors déterminer une propriété qui nous servira d&#39;identifiant (une propriété dont la valeur sera unique et que nous afficherons à nos utilisateurs). En général, on crée une propriété <code>username</code> ou <code>email</code> pour cela.</p><p>Et bien sûr, si nous stockons les informations en base, il faut demander à Symfony de hacher (hasher en franglais) les mots de passe.</p><p>La commande va nous ajouter / modifier plusieurs fichiers :</p><ul><li><code>src/Entity/User.php</code> notre entité User</li><li><code>src/Repository/UserRepository.php</code> le repository associé (noter la méthode <code>upgradePassword()</code>)</li><li><code>config/packages/security.yaml</code> met à jour la configuration sur la sécurité, pour prendre en compte notre entité User</li></ul><p>Si besoin d&#39;ajouter plus de champs, on peut utiliser la commande <code>make:entity</code>. Il s&#39;agit ensuite de créer une migration, de la vérifier et de la lancer.</p><p>On obtient alors une entité <code>User</code> comme celle-ci (je n&#39;ai pas ajouté de propriétés et ma propriété identifiant est <code>email</code>) :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Entity</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>UserRepository</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>Mapping</span> <span class="token keyword">as</span> <span class="token constant">ORM</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>User<span class="token punctuation">\</span>PasswordAuthenticatedUserInterface</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>User<span class="token punctuation">\</span>UserInterface</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Entity</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">repositoryClass</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">UserRepository</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">UserInterface</span><span class="token punctuation">,</span> PasswordAuthenticatedUserInterface</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Id</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>GeneratedValue</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;integer&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$id</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">length</span><span class="token punctuation">:</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">unique</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">true</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$email</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;json&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$roles</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;string&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token keyword return-type">int</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">email</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setEmail</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$email</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">email</span> <span class="token operator">=</span> <span class="token variable">$email</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * A visual identifier that represents this user.</span>
<span class="line">     *</span>
<span class="line">     * <span class="token keyword">@see</span> UserInterface</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getUserIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">email</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@deprecated</span> since Symfony 5.3, use getUserIdentifier instead</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">email</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@see</span> UserInterface</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$roles</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">roles</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// guarantee every user at least has ROLE_USER</span></span>
<span class="line">        <span class="token variable">$roles</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;ROLE_USER&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token variable">$roles</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setRoles</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$roles</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">roles</span> <span class="token operator">=</span> <span class="token variable">$roles</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@see</span> PasswordAuthenticatedUserInterface</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">password</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setPassword</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * Returning a salt is only needed, if you are not using a modern</span>
<span class="line">     * hashing algorithm (e.g. bcrypt or sodium) in your security.yaml.</span>
<span class="line">     *</span>
<span class="line">     * <span class="token keyword">@see</span> UserInterface</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant">null</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@see</span> UserInterface</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">eraseCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// If you store any temporary, sensitive data on the user, clear it here</span></span>
<span class="line">        <span class="token comment">// $this-&gt;plainPassword = null;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Je vous conseille ensuite de créer des fixtures (fausses données) pour entrer un ou plusieurs <code>User</code> dans votre base (utiliser la commande <code>make:fixtures</code> de <a href="https://symfony.com/doc/current/bundles/DoctrineFixturesBundle/index.html" target="_blank" rel="noopener noreferrer">DoctrineFixturesBundle</a>). Pour que les mots de passe soient encodés dans vos Fixtures, il faut bien penser à :</p><ul><li>injecter le service <code>UserPasswordHasherInterface</code> et l&#39;utiliser pour encoder le mot de passe</li><li>ou encoder vos mots de passe avec la commande <code>security:encode-password</code> de Symfony avant de les mettre dans vos <code>User</code></li></ul><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h2><p>La configuration se fait dans le fichier <code>config/packages/security.yaml</code>. Détaillons-le (j&#39;ai également ajouté des éléments utiles pour plus tard) :</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">security</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Pour activer certaines fonctionnalités (expérimentales) de Symfony </span></span>
<span class="line">    <span class="token key atrule">enable_authenticator_manager</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token comment"># https://symfony.com/doc/current/security.html#registering-the-user-hashing-passwords</span></span>
<span class="line">    <span class="token comment"># On définit ici les différents moyens de hasher </span></span>
<span class="line">    <span class="token comment"># nos mots de passe, en fonction des entités</span></span>
<span class="line">    <span class="token key atrule">password_hashers</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface</span><span class="token punctuation">:</span> <span class="token string">&#39;auto&#39;</span></span>
<span class="line">        <span class="token comment"># On dit au composant de Symfony de choisir </span></span>
<span class="line">        <span class="token comment"># l&#39;algorithme (le plus efficace)</span></span>
<span class="line">        <span class="token comment"># pour encoder les mots de passe de l&#39;entité User.</span></span>
<span class="line">        <span class="token comment"># On pourrait avoir plusieurs entités, avec des encodeurs différents</span></span>
<span class="line">        <span class="token key atrule">App\Entity\User</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">algorithm</span><span class="token punctuation">:</span> auto</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># On défini des providers (fournisseurs) pour dire quels entités </span></span>
<span class="line">    <span class="token comment"># nous servent à définir un utilisateur</span></span>
<span class="line">    <span class="token comment"># et quelle propriété nous permet de l&#39;identifier</span></span>
<span class="line">    <span class="token comment"># https://symfony.com/doc/current/security.html#where-do-users-come-from-user-providers</span></span>
<span class="line">    <span class="token key atrule">providers</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># used to reload user from session &amp; other features (e.g. switch_user)</span></span>
<span class="line">        <span class="token key atrule">app_user_provider</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">entity</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">class</span><span class="token punctuation">:</span> App\Entity\User</span>
<span class="line">                <span class="token key atrule">property</span><span class="token punctuation">:</span> email</span>
<span class="line">                </span>
<span class="line">    <span class="token comment"># Les firewalls vont nous permettre de définir différentes règles</span></span>
<span class="line">    <span class="token comment"># de sécurité (avec des manières de fonctionner différentes)</span></span>
<span class="line">    <span class="token comment"># Dans notre cas, le firewall main va être appliqué lors de l&#39;appel </span></span>
<span class="line">    <span class="token comment"># de toutes nos routes et va vérifier si l&#39;utilisateur</span></span>
<span class="line">    <span class="token comment"># peut ou non accéder à une page avec ses autorisations en cours</span></span>
<span class="line">    <span class="token comment"># (par exemple, s&#39;il peut accéder à une page sans être connecté)</span></span>
<span class="line">    <span class="token key atrule">firewalls</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">dev</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">pattern</span><span class="token punctuation">:</span> ^/(_(profiler<span class="token punctuation">|</span>wdt)<span class="token punctuation">|</span>css<span class="token punctuation">|</span>images<span class="token punctuation">|</span>js)/</span>
<span class="line">            <span class="token key atrule">security</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">        <span class="token key atrule">main</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">anonymous</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">            <span class="token key atrule">lazy</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">            <span class="token key atrule">provider</span><span class="token punctuation">:</span> app_user_provider</span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># On précise, au composant de sécurité, l&#39;authenticator </span></span>
<span class="line">            <span class="token comment"># à utiliser pour gérer notre connexion</span></span>
<span class="line">            <span class="token key atrule">custom_authenticator</span><span class="token punctuation">:</span> App\Security\Authenticator</span>
<span class="line">            <span class="token comment"># Plus de détails sur la fonctionnalité &quot;se souvenir de moi&quot; ici : </span></span>
<span class="line">            <span class="token comment"># https://symfony.com/doc/current/security/remember_me.html</span></span>
<span class="line">            <span class="token key atrule">remember_me</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">secret</span><span class="token punctuation">:</span>   <span class="token string">&#39;%kernel.secret%&#39;</span></span>
<span class="line">                <span class="token key atrule">lifetime</span><span class="token punctuation">:</span> <span class="token number">604800</span> <span class="token comment"># 1 semaine, en secondes</span></span>
<span class="line">                <span class="token key atrule">path</span><span class="token punctuation">:</span>     /</span>
<span class="line">                <span class="token comment"># Par défaut, cette fonctionnalité n&#39;est activé que si l&#39;utilisateur coche une case</span></span>
<span class="line">                <span class="token comment"># Vous pouvez faire en sorte que tout utilisateur connecté le reste 1 semaine</span></span>
<span class="line">                <span class="token comment"># en dé-commentant la ligne ci-dessous</span></span>
<span class="line">                <span class="token comment">#always_remember_me: true</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># Le nom de la route gérant la déconnexion</span></span>
<span class="line">            <span class="token comment"># Symfony se charge de déterminer s&#39;il s&#39;agit du nom d&#39;une route ou d&#39;un chemin</span></span>
<span class="line">            <span class="token comment"># (j&#39;aurais pu mettre /deconnexion, par exemple)</span></span>
<span class="line">            <span class="token key atrule">logout</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">path</span><span class="token punctuation">:</span> app_logout</span>
<span class="line">                <span class="token comment"># Vous pouvez également choisir une route où envoyer votre utilisateur après déconnexion</span></span>
<span class="line">                <span class="token comment"># target: app_any_route</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># activate different ways to authenticate</span></span>
<span class="line">            <span class="token comment"># https://symfony.com/doc/current/security.html#firewalls-authentication</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># https://symfony.com/doc/current/security/impersonating_user.html</span></span>
<span class="line">            <span class="token comment"># switch_user: true</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Ici, on donne des règles pour demander des rôles précis aux utilisateurs</span></span>
<span class="line">    <span class="token comment"># selon une expression régulière sur les chemins demandés.</span></span>
<span class="line">    <span class="token comment"># L&#39;intérêt est de demander des droits précis pour accéder à des zones du site</span></span>
<span class="line">    <span class="token comment"># (toute la partie admin, ou la gestion du compte, par exemple)</span></span>
<span class="line">    <span class="token comment"># Si l&#39;utilisateur n&#39;a pas les bons droits, nous pouvons l&#39;envoyer</span></span>
<span class="line">    <span class="token comment"># vers le formulaire de connexion, par exemple</span></span>
<span class="line">    <span class="token key atrule">access_control</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># On demande à l&#39;utilisateur d&#39;avoir le rôle ROLE_ADMIN, </span></span>
<span class="line">        <span class="token comment"># pour toutes les routes commençant par /admin</span></span>
<span class="line">        <span class="token comment"># - { path: ^/admin, roles: ROLE_ADMIN } </span></span>
<span class="line">        <span class="token comment"># On demande à l&#39;utilisateur d&#39;avoir le rôle ROLE_USER, </span></span>
<span class="line">        <span class="token comment"># pour toutes les routes commençant par /profile</span></span>
<span class="line">        <span class="token comment"># - { path: ^/profile, roles: ROLE_USER }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ce fichier est le cœur de la sécurisation de votre site, mais beaucoup d&#39;autres éléments peuvent venir le compléter et le raffiner.</p><h2 id="connecter-un-utilisateur" tabindex="-1"><a class="header-anchor" href="#connecter-un-utilisateur"><span>Connecter un utilisateur</span></a></h2><p><a href="https://symfony.com/doc/current/security/auth_providers.html" target="_blank" rel="noopener noreferrer">Les différents Authentication Providers fournis par Symfony</a></p><p>Des bundles comme le <a href="https://github.com/hwi/HWIOAuthBundle" target="_blank" rel="noopener noreferrer">HWIOAuthBundle</a> complètent encore cette liste.</p><p>L&#39;un des moyens les plus classiques, le formulaire de connexion, est le cas que nous allons voir. Si vous voulez apprendre en détail comment créer un système de connexion, je vous recommande chaudement <a href="https://symfony.com/doc/current/security/guard_authentication.html" target="_blank" rel="noopener noreferrer">la documentation de Symfony sur la création d&#39;une authentification par token d&#39;API</a>.</p><p>Pour créer notre système de connexion, nous allons utiliser la commande <code>make:auth</code> qui va nous préparer le travail.</p><p><code>php bin/console make:auth</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">What style of authentication do you want? [Empty authenticator]:</span>
<span class="line"> [0] Empty authenticator</span>
<span class="line"> [1] Login form authenticator</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ici, on fait le choix 1.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">The class name of the authenticator to create (e.g. AppCustomAuthenticator):</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Si on suit la documentation, on va entrer <code>LoginFormAuthenticator</code>, mais vous pouvez le nommer comme bon vous semble.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Choose a name for the controller class (e.g. SecurityController) [SecurityController]:</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Le nom de <code>SecurityController</code> est le plus courant, et vous le verrez dans beaucoup de projets Symfony.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Do you want to generate a &#39;/logout&#39; URL? (yes/no) [yes]:</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Je vous conseille de toujours créer un moyen pour vos utilisateurs de se déconnecter. Ils apprécieront 😉 .</p><p>On obtient alors plusieurs fichiers, dont le <code>SecurityController</code> suivant :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// src/Controller/SecurityController.php</span></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FrameworkBundle<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractController</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>Route</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Authentication<span class="token punctuation">\</span>AuthenticationUtils</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">SecurityController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;app_login&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token class-name type-declaration">AuthenticationUtils</span> <span class="token variable">$authenticationUtils</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// if ($this-&gt;getUser()) {</span></span>
<span class="line">        <span class="token comment">//     return $this-&gt;redirectToRoute(&#39;target_path&#39;);</span></span>
<span class="line">        <span class="token comment">// }</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// get the login error if there is one</span></span>
<span class="line">        <span class="token variable">$error</span> <span class="token operator">=</span> <span class="token variable">$authenticationUtils</span><span class="token operator">-&gt;</span><span class="token function">getLastAuthenticationError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// last username entered by the user</span></span>
<span class="line">        <span class="token variable">$lastUsername</span> <span class="token operator">=</span> <span class="token variable">$authenticationUtils</span><span class="token operator">-&gt;</span><span class="token function">getLastUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;security/login.html.twig&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;last_username&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$lastUsername</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;error&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$error</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/logout&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;app_logout&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>LogicException</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;This method can be blank - it will be intercepted by the logout key on your firewall.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Je vous conseille de personnaliser les chemins et les noms des routes, pour correspondre à <em>vos</em> conventions de nommage. Par exemple, je mettrai les chemins en français et renommerai les routes <code>security_login </code>et<code> security_logout</code>. Il faudra bien sûr modifier ces noms à plusieurs endroits (<code>login.html.twig</code> et <code>security.yaml</code>, notamment).</p><p>Notez que le fichier <code>login.html.twig</code> contient un formulaire html et non un formulaire Symfony. C&#39;est ici voulu et rien ne vous empêche d&#39;en créer un, si ce n&#39;est de faire extrêmement attention aux noms des champs. Il contient également une section à dé-commenter si vous souhaitez activer la fonctionnalité &quot;Se souvenir de moi&quot;.</p><p>Il nous reste maintenant à décortiquer / expliquer le <code>LoginFormAuthenticator</code> qui a été généré :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">// src/Security/LoginFormAuthenticator.php</span>
<span class="line"></span>
<span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Security</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>RedirectResponse</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Generator<span class="token punctuation">\</span>UrlGeneratorInterface</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Authentication<span class="token punctuation">\</span>Token<span class="token punctuation">\</span>TokenInterface</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Security</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Authenticator<span class="token punctuation">\</span>AbstractLoginFormAuthenticator</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Authenticator<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Badge<span class="token punctuation">\</span>CsrfTokenBadge</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Authenticator<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Badge<span class="token punctuation">\</span>UserBadge</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Authenticator<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Credentials<span class="token punctuation">\</span>PasswordCredentials</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Authenticator<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Authenticator<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>PassportInterface</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Util<span class="token punctuation">\</span>TargetPathTrait</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Authenticator</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractLoginFormAuthenticator</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">use</span> <span class="token package">TargetPathTrait</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// La route de login par défaut. À adapter à vos besoins (ici, je remplace par security_login, personnellement)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token constant">LOGIN_ROUTE</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;app_login&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Service de génération d&#39;URL / de chemins</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name type-declaration">UrlGeneratorInterface</span> <span class="token variable">$urlGenerator</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// On pourrait injecter ici d&#39;autres services qui nous seraient utiles lors de la connexion (un service qui vérifierait si nous nous connectons depuis une nouvelle IP, par exemple)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">UrlGeneratorInterface</span> <span class="token variable">$urlGenerator</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">urlGenerator</span> <span class="token operator">=</span> <span class="token variable">$urlGenerator</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">authenticate</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">PassportInterface</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// On récupère les données envoyées via POST</span></span>
<span class="line">        <span class="token comment">// Si vous modifiez les noms des champs de votre formulaire,</span></span>
<span class="line">        <span class="token comment">// c&#39;est dans cette méthode qu&#39;il faudra faire les modifications nécessaires</span></span>
<span class="line">        <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">request</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name static-context">Security</span><span class="token operator">::</span><span class="token constant">LAST_USERNAME</span><span class="token punctuation">,</span> <span class="token variable">$email</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Passport</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token keyword">new</span> <span class="token class-name">UserBadge</span><span class="token punctuation">(</span><span class="token variable">$email</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token keyword">new</span> <span class="token class-name">PasswordCredentials</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">request</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">[</span></span>
<span class="line">                <span class="token keyword">new</span> <span class="token class-name">CsrfTokenBadge</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;authenticate&#39;</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">request</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;_csrf_token&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Cette méthode permet de définir le comportement</span></span>
<span class="line">    <span class="token comment">// après une connexion réussie.</span></span>
<span class="line">    <span class="token comment">// Par défaut, on redirige l&#39;utilisateur vers la page demandée au départ</span></span>
<span class="line">    <span class="token comment">// ou une page définie par défaut (souvent, la page d&#39;accueil</span></span>
<span class="line">    <span class="token comment">// ou du compte)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">TokenInterface</span> <span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$firewallName</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token class-name return-type">Response</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Par défaut, un utilisateur est renvoyé vers la page où il souhaitait aller.</span></span>
<span class="line">        <span class="token comment">// Par exemple, s&#39;il avait demandé la page /admin, sans être connecté, la page de connexion apparait. Une fois ses identifiants entrés et vérifiés, il sera renvoyé vers cette page /admin, automatiquement</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$targetPath</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getTargetPath</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$firewallName</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedirectResponse</span><span class="token punctuation">(</span><span class="token variable">$targetPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// For example:</span></span>
<span class="line">        <span class="token comment">//return new RedirectResponse($this-&gt;urlGenerator-&gt;generate(&#39;some_route&#39;));</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;TODO: provide a valid redirect inside &#39;</span><span class="token operator">.</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Pour récupérer l&#39;url (le chemin) de la route de login</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getLoginUrl</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">urlGenerator</span><span class="token operator">-&gt;</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">LOGIN_ROUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>⚠️ Ne pas oublier de compléter la méthode <code>onAuthenticationSuccess</code> de notre authenticator et lui donner une url pour rediriger l&#39;utilisateur.</p><h2 id="utiliser-les-droits" tabindex="-1"><a class="header-anchor" href="#utiliser-les-droits"><span>Utiliser les droits</span></a></h2><p>Nos <code>User</code> ont toujours au moins le <code>ROLE_USER</code> (voir leur méthode <code>getRoles()</code>), donc un utilisateur connecté a au moins ce rôle. Voir également la section <code>role_hierarchy</code>dans le <code>security.yaml</code> de ce chapitre.</p><h3 id="security-yaml" tabindex="-1"><a class="header-anchor" href="#security-yaml"><span>Security.yaml</span></a></h3><p>Avec Symfony, il y a de nombreux moyens de vérifier si un utilisateur peut réaliser une action. Le premier, dans le fichier <code>security.yaml</code>, permet de définir une sécurisation pour des plages d&#39;urls :</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line">    <span class="token key atrule">access_control</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># On demande à l&#39;utilisateur d&#39;avoir le rôle ROLE_ADMIN, </span></span>
<span class="line">        <span class="token comment"># pour toutes les routes commençant par /admin</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> ^/admin<span class="token punctuation">,</span> <span class="token key atrule">roles</span><span class="token punctuation">:</span> ROLE_ADMIN <span class="token punctuation">}</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Cet exemple basique contient l&#39;essentiel, mais vous pouvez <a href="https://symfony.com/doc/current/security/access_control.html" target="_blank" rel="noopener noreferrer">aller beaucoup plus loin dans la précision</a>.</p><h3 id="isgranted-et-is-granted" tabindex="-1"><a class="header-anchor" href="#isgranted-et-is-granted"><span>IsGranted() et is_granted()</span></a></h3><p>Dans un contrôleur :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">    <span class="token comment">// src/Controller/AdminController.php</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">use</span> <span class="token package">Sensio<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FrameworkExtraBundle<span class="token punctuation">\</span>Configuration<span class="token punctuation">\</span>IsGranted</span><span class="token punctuation">;</span></span>
<span class="line">   </span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * Pour accéder à TOUTES les méthodes de ce contrôleur, il faut avoir le ROLE_ADMIN</span>
<span class="line">     */</span></span>
<span class="line">     <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">IsGranted</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;ROLE_ADMIN&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name-definition class-name">AdminController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">       <span class="token doc-comment comment">/**</span>
<span class="line">        * Il faut avoir le rôle ROLE_ADMIN pour cette méthode seulement</span>
<span class="line">        */</span></span>
<span class="line">        <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">IsGranted</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;ROLE_ADMIN&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">adminDashboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Fait exactement la même chose que l&#39;annotation au-dessus.</span></span>
<span class="line">            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">denyAccessUnlessGranted</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;ROLE_ADMIN&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// ...</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Dans un template :</p><div class="language-twig line-numbers-mode" data-highlighter="prismjs" data-ext="twig" data-title="twig"><pre><code><span class="line"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">if</span> is_granted<span class="token punctuation">(</span><span class="token string"><span class="token punctuation">&#39;</span>ROLE_ADMIN<span class="token punctuation">&#39;</span></span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%}</span></span></span>
<span class="line">    <span class="token twig language-twig"><span class="token comment">{# Seuls les admins peuvent voir ceci #}</span></span></span>
<span class="line"><span class="token twig language-twig"><span class="token delimiter punctuation">{%</span> <span class="token tag-name keyword">endif</span> <span class="token delimiter punctuation">%}</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vous pouvez également utiliser cette fonctionnalité dans un service, en injectant le service <code>Symfony\Component\Security\Core\Security</code> :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// src/Newsletter/NewsletterManager.php</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ...</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>AccessDeniedException</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Security</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">SalesReportManager</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$security</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Security</span> <span class="token variable">$security</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">security</span> <span class="token operator">=</span> <span class="token variable">$security</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">sendNewsletter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$salesData</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">security</span><span class="token operator">-&gt;</span><span class="token function">isGranted</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;ROLE_SALES_ADMIN&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$salesData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;top_secret_numbers&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="recuperer-le-user-connecte" tabindex="-1"><a class="header-anchor" href="#recuperer-le-user-connecte"><span>Récupérer le <code>User</code> connecté</span></a></h2><h3 id="dans-un-controleur" tabindex="-1"><a class="header-anchor" href="#dans-un-controleur"><span>Dans un contrôleur</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Renvoie votre utilisateur (ou null s&#39;il n&#39;est pas connecté)</span></span>
<span class="line">    <span class="token comment">// Il est conseillé d&#39;ajouter un commentaire pour que l&#39;IDE connaisse</span></span>
<span class="line">    <span class="token comment">// la classe exacte utilisée (par défaut, il voir un objet UserInterface, sans vos méthodes)</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name">User</span> <span class="token parameter">$user</span> */</span>    </span>
<span class="line">    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dans-un-service" tabindex="-1"><a class="header-anchor" href="#dans-un-service"><span>Dans un service</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// src/Service/ExampleService.php</span></span>
<span class="line"><span class="token comment">// ...</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Security<span class="token punctuation">\</span>Core<span class="token punctuation">\</span>Security</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ExampleService</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$security</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Security</span> <span class="token variable">$security</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Il vaut mieux éviter d&#39;appeler le User directement</span></span>
<span class="line">        <span class="token comment">// dans le constructeur d&#39;un service.</span></span>
<span class="line">        <span class="token comment">// Il pourrait ne pas être correctement initialisé à ce moment-là</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">security</span> <span class="token operator">=</span> <span class="token variable">$security</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Retourne le User (ou null si pas connecté)</span></span>
<span class="line">        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">security</span><span class="token operator">-&gt;</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dans-un-template" tabindex="-1"><a class="header-anchor" href="#dans-un-template"><span>Dans un template</span></a></h3><p><code>app.user</code> Retourne le User (ou null si pas connecté)</p><h2 id="inscription" tabindex="-1"><a class="header-anchor" href="#inscription"><span>Inscription</span></a></h2><p>Pour créer un formulaire d&#39;inscription, vous pouvez <a class="route-link" href="/cours/symfony/25-formulaires.html">créer un formulaire classique</a> ou utiliser la commande : <code>php bin/console make:registration-form</code> (cette solution est recommandée, car plus simple 😉 )</p><h2 id="gerer-les-droits-avec-les-voters" tabindex="-1"><a class="header-anchor" href="#gerer-les-droits-avec-les-voters"><span>Gérer les droits avec les Voters</span></a></h2><p>Une fonctionnalité très avancée, les Voters, vous permet de gérer les droits aussi finement que vous le souhaitez. Bien que les rôles permettent déjà beaucoup de puissance, il arrive que des droits plus précis soient nécessaires. Par exemple, si vous créez un site pour une grosse entreprise, avec un service marketing et un autre commercial, il se peut que chaque service (et chaque utilisateur de ces services) aient accès seulement à des fonctionnalités précises.</p><p>Pour ces cas, bien plus complexes, de gestion des ACL (Access Control Lists), je vous recommande très fortement <a href="https://symfony.com/doc/current/security/voters.html" target="_blank" rel="noopener noreferrer">la documentation Symfony sur les voters</a> et vous pouvez aller encore plus loin, avec <a href="https://symfony.com/doc/current/components/security/authorization.html" target="_blank" rel="noopener noreferrer">la documentation sur le processus d&#39;autorisation de Symfony</a></p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Dernières mise à jour : </span><!----></div><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/cours/symfony/27-event-listeners.html" aria-label="Event listeners/subscribers"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Event listeners/subscribers</span></div></a><a class="route-link auto-link next" href="/cours/symfony/40-bundles.html" aria-label="Bundles"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Bundles</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/cours/assets/app-BkblVdII.js" defer></script>
  </body>
</html>
