<!doctype html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Doctrine et la BdD | Cours de R√©mi Jarjat</title><meta name="description" content="Les formations de R√©mi Jarjat pour Human Booster">
    <link rel="preload" href="/cours/assets/style-BEIxaUV1.css" as="style"><link rel="stylesheet" href="/cours/assets/style-BEIxaUV1.css">
    <link rel="modulepreload" href="/cours/assets/app-BkblVdII.js"><link rel="modulepreload" href="/cours/assets/24-doctrine.html-Dy9mTQaU.js">
    <link rel="prefetch" href="/cours/assets/index.html-DNrA6HK6.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-CXP878eB.js" as="script"><link rel="prefetch" href="/cours/assets/00-intro.html-Bk8UQcqp.js" as="script"><link rel="prefetch" href="/cours/assets/05-ftp.html-E0Ur07Av.js" as="script"><link rel="prefetch" href="/cours/assets/10-wordpress.html-7q_yRW6f.js" as="script"><link rel="prefetch" href="/cours/assets/20-git.html-ID_OUtqT.js" as="script"><link rel="prefetch" href="/cours/assets/21-github-pages.html-BgRPfY28.js" as="script"><link rel="prefetch" href="/cours/assets/30-symfony-angular.html-ChdxRAKi.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-DYPvKtbL.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-D32X3tpQ.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-BB_fAsgA.js" as="script"><link rel="prefetch" href="/cours/assets/0-terminologie.html-DGfn3tkH.js" as="script"><link rel="prefetch" href="/cours/assets/1-before_start.html-C8oSeMYR.js" as="script"><link rel="prefetch" href="/cours/assets/2-init_local.html-CJ1oLmNZ.js" as="script"><link rel="prefetch" href="/cours/assets/3-record_changes.html-mTq4a0nY.js" as="script"><link rel="prefetch" href="/cours/assets/4-branches.html-CcALPmAX.js" as="script"><link rel="prefetch" href="/cours/assets/5-common-work.html-BuKBh4ba.js" as="script"><link rel="prefetch" href="/cours/assets/6-rollback.html-DCW2n4gz.js" as="script"><link rel="prefetch" href="/cours/assets/7-rewrite-history.html-CMox542w.js" as="script"><link rel="prefetch" href="/cours/assets/8-tools.html-dbbGRguW.js" as="script"><link rel="prefetch" href="/cours/assets/98-exercices.html-BdTaL4hu.js" as="script"><link rel="prefetch" href="/cours/assets/99-examples.html-C_ldXykC.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-kzVuneS9.js" as="script"><link rel="prefetch" href="/cours/assets/1-bases.html-CGEYN-2D.js" as="script"><link rel="prefetch" href="/cours/assets/2-logique.html-61J_sYJu.js" as="script"><link rel="prefetch" href="/cours/assets/3-dom.html-BRsCseWv.js" as="script"><link rel="prefetch" href="/cours/assets/4-jquery.html-BToUe5Mr.js" as="script"><link rel="prefetch" href="/cours/assets/5-ajax.html-B4q0yYBG.js" as="script"><link rel="prefetch" href="/cours/assets/6-poo.html-DwJiHe1p.js" as="script"><link rel="prefetch" href="/cours/assets/90-webpack.html-DFKynxKS.js" as="script"><link rel="prefetch" href="/cours/assets/98-outils.html-dtYJRMDJ.js" as="script"><link rel="prefetch" href="/cours/assets/99-revisions.html-DPkBzUUG.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-538Evebu.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-DQl6xswL.js" as="script"><link rel="prefetch" href="/cours/assets/0-install.html-DLL9VTcs.js" as="script"><link rel="prefetch" href="/cours/assets/1-historique.html-DUZ9QH8s.js" as="script"><link rel="prefetch" href="/cours/assets/2-dossiers.html-C8OBAZKb.js" as="script"><link rel="prefetch" href="/cours/assets/3-processus.html-DkBAb6HO.js" as="script"><link rel="prefetch" href="/cours/assets/4-bases.html-BRpP6Qoh.js" as="script"><link rel="prefetch" href="/cours/assets/5-advanced.html-Z6iglftC.js" as="script"><link rel="prefetch" href="/cours/assets/6-other-technologies.html-BPMMqcd8.js" as="script"><link rel="prefetch" href="/cours/assets/98-exercices.html-DdGSvc_3.js" as="script"><link rel="prefetch" href="/cours/assets/99-corrections.html-B9a9jG4k.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-CJUpZt3J.js" as="script"><link rel="prefetch" href="/cours/assets/00-environnement.html-eHcCWfO4.js" as="script"><link rel="prefetch" href="/cours/assets/01-bases.html-CEP22wx2.js" as="script"><link rel="prefetch" href="/cours/assets/02-tests-et-boucles.html-BJvaq02O.js" as="script"><link rel="prefetch" href="/cours/assets/03-fonctions.html-CySeJIXt.js" as="script"><link rel="prefetch" href="/cours/assets/04-user.html-BbC9tlnp.js" as="script"><link rel="prefetch" href="/cours/assets/05-temporisation-de-sortie.html-BprGTVyS.js" as="script"><link rel="prefetch" href="/cours/assets/10-doc.html-hbsDLq8X.js" as="script"><link rel="prefetch" href="/cours/assets/20-objet.html-tavW-9t-.js" as="script"><link rel="prefetch" href="/cours/assets/21-heritage.html-eZii40nq.js" as="script"><link rel="prefetch" href="/cours/assets/22-factorize.html-C_3OxGkX.js" as="script"><link rel="prefetch" href="/cours/assets/30-pdo.html-DZNmK1yi.js" as="script"><link rel="prefetch" href="/cours/assets/40-mvc.html-B7wW4tol.js" as="script"><link rel="prefetch" href="/cours/assets/50-rest.html-DA9kZAyq.js" as="script"><link rel="prefetch" href="/cours/assets/80-bases.html-DxX1aKvt.js" as="script"><link rel="prefetch" href="/cours/assets/81-multiple-files.html-DWDgT5CY.js" as="script"><link rel="prefetch" href="/cours/assets/82-post-session.html-CzHm_mUI.js" as="script"><link rel="prefetch" href="/cours/assets/83-cart-get-session.html-JZBhpCAK.js" as="script"><link rel="prefetch" href="/cours/assets/84-objects.html-CBCLsk4Q.js" as="script"><link rel="prefetch" href="/cours/assets/85-bdd-pdo.html-DLNT2Shx.js" as="script"><link rel="prefetch" href="/cours/assets/91-computer-preparation.html-04nylJYm.js" as="script"><link rel="prefetch" href="/cours/assets/92-jdr.html-PmXnWOug.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-BCpYffRo.js" as="script"><link rel="prefetch" href="/cours/assets/01-installation.html-zMXAMdp5.js" as="script"><link rel="prefetch" href="/cours/assets/10-structure.html-BqkOypUB.js" as="script"><link rel="prefetch" href="/cours/assets/20-routing.html-DEmbotUh.js" as="script"><link rel="prefetch" href="/cours/assets/21-controllers.html-Dw-shP-A.js" as="script"><link rel="prefetch" href="/cours/assets/22-twig.html-BtHhS6Zz.js" as="script"><link rel="prefetch" href="/cours/assets/23-injection.html-FYyHm-3g.js" as="script"><link rel="prefetch" href="/cours/assets/25-formulaires.html-ClWG20Ye.js" as="script"><link rel="prefetch" href="/cours/assets/26-translation.html-Bx0CL1gK.js" as="script"><link rel="prefetch" href="/cours/assets/27-event-listeners.html-Cbzkc52t.js" as="script"><link rel="prefetch" href="/cours/assets/30-user.html-BqWDoicu.js" as="script"><link rel="prefetch" href="/cours/assets/40-bundles.html-CcDr5e5S.js" as="script"><link rel="prefetch" href="/cours/assets/41-easy-admin.html-D4Tpj4o2.js" as="script"><link rel="prefetch" href="/cours/assets/42-api-platform.html-BFrCkmar.js" as="script"><link rel="prefetch" href="/cours/assets/80-cheat-sheet.html-CqetZgPG.js" as="script"><link rel="prefetch" href="/cours/assets/81-quotidien.html-3aoij3Mw.js" as="script"><link rel="prefetch" href="/cours/assets/82-docker.html-DANOmWA1.js" as="script"><link rel="prefetch" href="/cours/assets/90-doggies.html-CF6BnQw2.js" as="script"><link rel="prefetch" href="/cours/assets/99-exercices.html-Hfy05qP_.js" as="script"><link rel="prefetch" href="/cours/assets/index.html-Cky5vnQE.js" as="script"><link rel="prefetch" href="/cours/assets/404.html-BBk7B_gA.js" as="script"><link rel="prefetch" href="/cours/assets/mermaid.esm.min-DlybqT7H.js" as="script"><link rel="prefetch" href="/cours/assets/prod-C3uXySb1.js" as="script"><link rel="prefetch" href="/cours/assets/prod-C3uXySb1.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-audio-DWxEHD26.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-video-BzoGie0P.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-hls-DfU-v-dq.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-dash-D54rnz3i.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-vimeo-BK2DV3IR.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-krOAtKMi-C3UUF7YD.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-youtube-DYOMeSWP.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-Zc3I7oOd-CA6XwpqT.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-CWDlegKy-CNXmzpVv.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-D0D6ufFF-BTjCMPz2.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-player-default-layout-uAtmJz4O.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-player-ui-3Hy2pYjc.js" as="script"><link rel="prefetch" href="/cours/assets/vidstack-QR8zGkwr-hi-wEx3g.js" as="script"><link rel="prefetch" href="/cours/assets/setupDevtools-7MC2TMWH-C80vdosD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/cours/"><img class="vp-site-logo" src="/cours/assets/LogoHB2.png" alt="Cours de R√©mi Jarjat"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Cours de R√©mi Jarjat</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><!----><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/" aria-label="Liste des cours"><!---->Liste des cours<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/general/" aria-label="Culture num√©rique"><!---->Culture num√©rique<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/git/" aria-label="Git"><!---->Git<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/0-terminologie.html" aria-label="Terminologie"><!---->Terminologie<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/1-before_start.html" aria-label="Avant de commencer"><!---->Avant de commencer<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/2-init_local.html" aria-label="Cr√©er un d√©p√¥t (local)"><!---->Cr√©er un d√©p√¥t (local)<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/3-record_changes.html" aria-label="Enregistrer des changements"><!---->Enregistrer des changements<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/4-branches.html" aria-label="Des branches"><!---->Des branches<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/5-common-work.html" aria-label="Mise en commun du travail"><!---->Mise en commun du travail<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/6-rollback.html" aria-label="Annuler des changements"><!---->Annuler des changements<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/7-rewrite-history.html" aria-label="R√©√©crire l&#39;historique"><!---->R√©√©crire l&#39;historique<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/8-tools.html" aria-label="Des outils pour se simplifier Git"><!---->Des outils pour se simplifier Git<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/98-exercices.html" aria-label="Exercices"><!---->Exercices<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/git/99-examples.html" aria-label="Exemples pratiques"><!---->Exemples pratiques<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/linux/" aria-label="Linux"><!---->Linux<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/0-install.html" aria-label="Installation"><!---->Installation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/1-historique.html" aria-label="Historique"><!---->Historique<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/2-dossiers.html" aria-label="Rangement des fichiers"><!---->Rangement des fichiers<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/3-processus.html" aria-label="Les processus"><!---->Les processus<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/4-bases.html" aria-label="Commandes de base"><!---->Commandes de base<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/5-advanced.html" aria-label="Commandes avanc√©es"><!---->Commandes avanc√©es<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/6-other-technologies.html" aria-label="/linux/6-other-technologies.html"><!---->/linux/6-other-technologies.html<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/98-exercices.html" aria-label="Exercices"><!---->Exercices<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/linux/99-corrections.html" aria-label="Correction des exercices"><!---->Correction des exercices<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/php/" aria-label="PHP"><!---->PHP<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/00-environnement.html" aria-label="Environnement de travail"><!---->Environnement de travail<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/01-bases.html" aria-label="Bases du PHP"><!---->Bases du PHP<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/02-tests-et-boucles.html" aria-label="Tests et boucles"><!---->Tests et boucles<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/03-fonctions.html" aria-label="Proc√©dures et fonctions"><!---->Proc√©dures et fonctions<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/04-user.html" aria-label="Interagir avec l&#39;utilisateur"><!---->Interagir avec l&#39;utilisateur<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/05-temporisation-de-sortie.html" aria-label="La temporisation de sortie"><!---->La temporisation de sortie<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/10-doc.html" aria-label="PHP Doc et PSR"><!---->PHP Doc et PSR<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/20-objet.html" aria-label="PHP Orient√© objet"><!---->PHP Orient√© objet<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/21-heritage.html" aria-label="H√©ritage et objets"><!---->H√©ritage et objets<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/22-factorize.html" aria-label="Factorisation"><!---->Factorisation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/30-pdo.html" aria-label="Manipuler la BdD avec PDO (PHP Data Object)"><!---->Manipuler la BdD avec PDO (PHP Data Object)<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/40-mvc.html" aria-label="Architecture MVC"><!---->Architecture MVC<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/50-rest.html" aria-label="Webservices REST"><!---->Webservices REST<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/80-bases.html" aria-label="Exercices - Bases"><!---->Exercices - Bases<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/81-multiple-files.html" aria-label="Exercices - S√©parer en plusieurs fichiers"><!---->Exercices - S√©parer en plusieurs fichiers<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/82-post-session.html" aria-label="Exercices - POST et SESSION"><!---->Exercices - POST et SESSION<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/83-cart-get-session.html" aria-label="Exercices - Panier et validation"><!---->Exercices - Panier et validation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/84-objects.html" aria-label="Exercices - Objets"><!---->Exercices - Objets<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/85-bdd-pdo.html" aria-label="Exercices - BdD avec PDO"><!---->Exercices - BdD avec PDO<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/91-computer-preparation.html" aria-label="Projet - montage d&#39;ordinateurs"><!---->Projet - montage d&#39;ordinateurs<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/php/92-jdr.html" aria-label="Projet - Personnages de Jeux de R√¥le"><!---->Projet - Personnages de Jeux de R√¥le<!----></a><!----></li><!--]--></ul></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active collapsible" href="/cours/symfony/" aria-label="Symfony"><!---->Symfony<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/01-installation.html" aria-label="Installer Symfony et son environnement de travail"><!---->Installer Symfony et son environnement de travail<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/10-structure.html" aria-label="Structure et utilisation d&#39;un projet"><!---->Structure et utilisation d&#39;un projet<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/20-routing.html" aria-label="Le routing"><!---->Le routing<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/21-controllers.html" aria-label="Les controllers"><!---->Les controllers<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/22-twig.html" aria-label="Twig"><!---->Twig<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/23-injection.html" aria-label="Les services et l&#39;injection de d√©pendances"><!---->Les services et l&#39;injection de d√©pendances<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/cours/symfony/24-doctrine.html" aria-label="Doctrine et la BdD"><!---->Doctrine et la BdD<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/25-formulaires.html" aria-label="Formulaires"><!---->Formulaires<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/26-translation.html" aria-label="Les traductions"><!---->Les traductions<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/27-event-listeners.html" aria-label="Event listeners/subscribers"><!---->Event listeners/subscribers<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/30-user.html" aria-label="Connexion et s√©curisation"><!---->Connexion et s√©curisation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/40-bundles.html" aria-label="Bundles"><!---->Bundles<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/41-easy-admin.html" aria-label="Easy Admin Bundle"><!---->Easy Admin Bundle<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/42-api-platform.html" aria-label="API Platform"><!---->API Platform<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/80-cheat-sheet.html" aria-label="Pense-b√™tes"><!---->Pense-b√™tes<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/81-quotidien.html" aria-label="Symfony au quotidien"><!---->Symfony au quotidien<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/82-docker.html" aria-label="Travailler avec Docker"><!---->Travailler avec Docker<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/90-doggies.html" aria-label="Projet : annonces de SPA / √©leveurs"><!---->Projet : annonces de SPA / √©leveurs<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/symfony/99-exercices.html" aria-label="Exercices"><!---->Exercices<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/js/" aria-label="Javascript"><!---->Javascript<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/1-bases.html" aria-label="Les bases du langage"><!---->Les bases du langage<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/2-logique.html" aria-label="Manipulation logique"><!---->Manipulation logique<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/3-dom.html" aria-label="Le DOM"><!---->Le DOM<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/4-jquery.html" aria-label="JQuery"><!---->JQuery<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/5-ajax.html" aria-label="Ajax"><!---->Ajax<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/6-poo.html" aria-label="Programmation orient√©e objet"><!---->Programmation orient√©e objet<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/90-webpack.html" aria-label="Webpack"><!---->Webpack<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/98-outils.html" aria-label="Outils utiles"><!---->Outils utiles<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/js/99-revisions.html" aria-label="R√©visions"><!---->R√©visions<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/lamp/" aria-label="Serveur Lamp"><!---->Serveur Lamp<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading collapsible" href="/cours/deploy/" aria-label="D√©ploiement"><!---->D√©ploiement<!----></a><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/00-intro.html" aria-label="Des outils et mani√®res de faire"><!---->Des outils et mani√®res de faire<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/05-ftp.html" aria-label="D√©ploiement par FTP"><!---->D√©ploiement par FTP<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/10-wordpress.html" aria-label="Wordpress"><!---->Wordpress<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/20-git.html" aria-label="Int√©grer Git dans le processus"><!---->Int√©grer Git dans le processus<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/21-github-pages.html" aria-label="GitHub Pages pour d√©ployer facilement"><!---->GitHub Pages pour d√©ployer facilement<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cours/deploy/30-symfony-angular.html" aria-label="Symfony et Angular"><!---->Symfony et Angular<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/docker/" aria-label="Docker"><!---->Docker<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/cours/ci/" aria-label="Int√©gration continue"><!---->Int√©gration continue<!----></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="doctrine-et-la-bdd" tabindex="-1"><a class="header-anchor" href="#doctrine-et-la-bdd"><span>Doctrine et la BdD</span></a></h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#pour-resumer" class="router-link-active router-link-exact-active">Pour r√©sumer</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#configurer-la-bdd" class="router-link-active router-link-exact-active">Configurer la BdD</a><ul><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#debug-pour-mac-et-mamp" class="router-link-active router-link-exact-active">D√©bug pour Mac et Mamp</a></li></ul></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#configurer-doctrine" class="router-link-active router-link-exact-active">Configurer Doctrine</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#creer-des-entites" class="router-link-active router-link-exact-active">Cr√©er des entit√©s</a><ul><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#gerer-les-heritages-entre-les-objets" class="router-link-active router-link-exact-active">G√©rer les h√©ritages entre les objets</a></li></ul></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#les-migrations" class="router-link-active router-link-exact-active">Les migrations</a><ul><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#annuler-une-migration" class="router-link-active router-link-exact-active">Annuler une migration</a></li></ul></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#l-entitymanager-pour-sauvegarder" class="router-link-active router-link-exact-active">L&#39;EntityManager pour sauvegarder</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#le-paramconverter-de-doctrine" class="router-link-active router-link-exact-active">Le ParamConverter de Doctrine</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#le-repository-pour-recuperer-des-entites" class="router-link-active router-link-exact-active">Le Repository pour r√©cup√©rer des entit√©s</a><ul><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#findall" class="router-link-active router-link-exact-active">findAll()</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#find-id" class="router-link-active router-link-exact-active">find($id)</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#findoneby-array-criteria-array-orderby-null" class="router-link-active router-link-exact-active">findOneBy(array $criteria, array $orderBy = null)</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#findby-array-criteria-array-orderby-null-limit-null-offset-null" class="router-link-active router-link-exact-active">findBy(array $criteria, array $orderBy = null, $limit = null, $offset = null)</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#le-querybuilder-construire-ses-propres-requetes" class="router-link-active router-link-exact-active">Le QueryBuilder : construire ses propres requ√™tes</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#les-jointures" class="router-link-active router-link-exact-active">Les jointures</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#les-differentes-methodes-du-querybuilder" class="router-link-active router-link-exact-active">Les diff√©rentes m√©thodes du QueryBuilder</a></li></ul></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#tester-nos-requetes" class="router-link-active router-link-exact-active">Tester nos requ√™tes</a></li><li><a aria-current="page" href="/cours/symfony/24-doctrine.html#creer-de-fausses-donnees-fixtures" class="router-link-active router-link-exact-active">Cr√©er de fausses donn√©es (fixtures)</a></li></ul></nav><p><a href="https://symfony.com/doc/current/doctrine.html" target="_blank" rel="noopener noreferrer">La documentation officielle</a> que nous allons suivre.</p><div style="position:relative;padding-bottom:56.25%;height:0;"><iframe src="https://www.loom.com/embed/02251e40b02349dd8bd34775a05a4e2c" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div><h2 id="pour-resumer" tabindex="-1"><a class="header-anchor" href="#pour-resumer"><span>Pour r√©sumer</span></a></h2><ul><li>Pour mettre en place la base, <ul><li>cr√©er/modifier la variable <code>DATABASE_URL</code> dans <code>.env</code></li><li>Lancer la commande <code>doctrine:database:create</code></li></ul></li><li>Ex√©cuter les migrations <code>doctrine:migrations:migrate</code> pour mettre √† jour la <abbr title="Base de Donn√©es">BdD</abbr></li><li>Cr√©er des entit√©s avec <code>make:entity</code></li><li>Cr√©er une ou des migrations avec <code>make:migration</code> (ou <code>doctrine:migrations:diff</code>) (‚ö†Ô∏è pensez √† les ex√©cuter avec <code>doctrine:migrations:migrate</code>)</li><li>Cr√©er de fausses donn√©es avec <code>DoctrineFixturesBundle</code> et les charger avec <code>doctrine:fixtures:load</code></li><li>Pour ins√©rer des donn√©es dans la base, injecter le service <code>EntityManagerInterface</code> et utiliser les m√©thodes <code>persist()</code> et <code>flush()</code></li><li>Pour r√©cup√©rer des donn√©es de la base, injecter le repository correspondant √† la table et utiliser ses m√©thodes <ul><li>Si besoin de requ√™tes plus complexes, cr√©er des m√©thodes en utilisant le <code>QueryBuilder</code></li></ul></li></ul><h2 id="configurer-la-bdd" tabindex="-1"><a class="header-anchor" href="#configurer-la-bdd"><span>Configurer la BdD</span></a></h2><p>Pour travailler avec Doctrine, pas besoin de cr√©er une base de donn√©es, nous allons voir comment le faire simplement avec la ligne de commande.</p><p>D&#39;abord, configurer l&#39;acc√®s √† la base. Pour cela, modifier le fichier <code>.env</code> :</p><div class="language-dotenv line-numbers-mode" data-highlighter="prismjs" data-ext="dotenv" data-title="dotenv"><pre><code><span class="line"># In all environments, the following files are loaded if they exist,</span>
<span class="line"># the latter taking precedence over the former:</span>
<span class="line">#</span>
<span class="line"># * .env                contains default values for the environment variables needed by the app</span>
<span class="line"># * .env.local          uncommitted file with local overrides</span>
<span class="line"># * .env.$APP_ENV       committed environment-specific defaults</span>
<span class="line"># * .env.$APP_ENV.local uncommitted environment-specific overrides</span>
<span class="line">#</span>
<span class="line"># Real environment variables win over .env files.</span>
<span class="line">#</span>
<span class="line"># DO NOT DEFINE PRODUCTION SECRETS IN THIS FILE NOR IN ANY OTHER COMMITTED FILES.</span>
<span class="line">#</span>
<span class="line"># Run &quot;composer dump-env prod&quot; to compile .env files for production use (requires symfony/flex &gt;=1.2).</span>
<span class="line"># https://symfony.com/doc/current/best_practices.html#use-environment-variables-for-infrastructure-configuration</span>
<span class="line"></span>
<span class="line"># ##&gt; symfony/framework-bundle ###</span>
<span class="line">APP_ENV=dev</span>
<span class="line">APP_SECRET=e194910b102ef1a834e9967fb13ec881</span>
<span class="line"># ##&lt; symfony/framework-bundle ###</span>
<span class="line"></span>
<span class="line"># ##&gt; symfony/mailer ###</span>
<span class="line"># MAILER_DSN=smtp://localhost</span>
<span class="line"># ##&lt; symfony/mailer ###</span>
<span class="line"></span>
<span class="line"># ##&gt; doctrine/doctrine-bundle ###</span>
<span class="line"># Format described at https://www.doctrine-project.org/projects/doctrine-dbal/en/latest/reference/configuration.html#connecting-using-a-url</span>
<span class="line"># IMPORTANT: You MUST configure your server version, either here or in config/packages/doctrine.yaml</span>
<span class="line">#</span>
<span class="line"># DATABASE_URL=&quot;sqlite:///%kernel.project_dir%/var/data.db&quot;</span>
<span class="line"># DATABASE_URL=&quot;mysql://db_user:db_password@127.0.0.1:3306/db_name?serverVersion=5.7&quot;</span>
<span class="line">DATABASE_URL=&quot;mysql://root:@127.0.0.1:3306/test-symfony?serverVersion=5.7&quot;</span>
<span class="line"># ##&lt; doctrine/doctrine-bundle ###</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>La ligne qui nous int√©resse est celle-ci :</p><div class="language-dotenv line-numbers-mode" data-highlighter="prismjs" data-ext="dotenv" data-title="dotenv"><pre><code><span class="line">DATABASE_URL=&quot;mysql://root:pass@127.0.0.1:3306/test-symfony?serverVersion=5.7&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Si vous utilisez MariaDB, il est plus probable qu&#39;une variante comme celle-ci vous convienne mieux :</p><div class="language-dotenv line-numbers-mode" data-highlighter="prismjs" data-ext="dotenv" data-title="dotenv"><pre><code><span class="line">DATABASE_URL=&quot;mysql://root:pass@127.0.0.1:3307/test-symfony?serverVersion=mariadb-10.4.13&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>D√©composons-la pour comprendre ce qu&#39;elle fait et comment :</p><ul><li><code>mysql://</code> est le protocole √† utiliser (le type de BdD qu&#39;on utilise, si vous pr√©f√©rez). Ici, mysql</li><li><code>root:pass</code> est la combinaison <code>identifiant:motDePasse</code> √† utiliser pour se connecter √† notre BdD. Avec Wamp, nous allons plut√¥t avoir <code>root:</code> et pour Mamp <code>root:root</code></li><li><code>127.0.0.1:3306</code> est l&#39;adresse IP de notre BdD, suivi du port. Tant que nous travaillons en local, nous n&#39;avons pas besoin de les changer. Noter que <code>127.0.0.1</code> peut √™tre remplac√© par <code>localhost</code>, les deux sont √©quivalent.</li><li><code>/test-symfony</code> est le nom de la BdD que l&#39;on va utiliser. Pas besoin de la cr√©er avant, nous la cr√©erons juste apr√®s.</li></ul><p>Pour des exemples avec d&#39;autres types de BdD, je vous invite √† regarder la <a href="https://symfony.com/doc/current/doctrine.html#configuring-the-database" target="_blank" rel="noopener noreferrer">section d√©di√©e de la doc officielle</a></p><p>Une fois configur√©e, lancer la commande <code>php bin/console doctrine:database:create</code> dans votre terminal pour cr√©er la BdD. Bien s√ªr, pas besoin de le faire si votre BdD existe d√©j√†.</p><p>Si vous souhaitez afficher la liste des commandes disponibles avec Doctrine, lancer la commande <code>php bin/console list doctrine</code>.</p><h3 id="debug-pour-mac-et-mamp" tabindex="-1"><a class="header-anchor" href="#debug-pour-mac-et-mamp"><span>D√©bug pour Mac et Mamp</span></a></h3><p>Si vous √™tes sur Mac avec Mamp, la configuration est diff√©rente :</p><div class="language-dotenv line-numbers-mode" data-highlighter="prismjs" data-ext="dotenv" data-title="dotenv"><pre><code><span class="line">DATABASE_URL=&quot;mysql://root:root@localhost:8889/exo-symfony?serverVersion=5.7&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Vous pouvez √©galement avoir des soucis de version de php. Le conflit est entre la version de php de votre Mac et celle de Mamp.</p><p>Pour les r√©gler, voici une manipulation qui peut vous aider :</p><ul><li>Trouver votre version de PHP dans Mamp (disons 7.4.12 pour la suite)</li><li>Trouver la version de PHP sur votre Mac (ouvrir un terminal et taper <code>php -v</code>). Si elle est diff√©rente de celle de Mamp, faire ce qui suit.</li><li><code>sudo ln -s /Applications/MAMP/bin/php/php7.4.12/bin/php /usr/local/bin/php</code> (remplacer <code>php7.4.12</code> par votre version de PHP dans Mamp, ex <code>php7.4.9</code>)</li><li>Ouvrir un nouveau terminal et lancer la commande <code>php -v</code> pour v√©rifier que le changement a √©t√© effectu√©</li></ul><h2 id="configurer-doctrine" tabindex="-1"><a class="header-anchor" href="#configurer-doctrine"><span>Configurer Doctrine</span></a></h2><p>Regardons le fichier <code>config/packages/doctrine.yaml</code>. Nous n&#39;avons normalement rien besoin de modifier.</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># le premier niveau nous indique que nous configurons Doctrine (logique ;) )</span></span>
<span class="line"><span class="token key atrule">doctrine</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Cette section sert √† configurer l&#39;acc√®s √† la BdD</span></span>
<span class="line">    <span class="token key atrule">dbal</span><span class="token punctuation">:</span> </span>
<span class="line">        <span class="token comment"># Ici, nous r√©cup√©rons notre variable d&#39;environnement DATABASE_URL (d√©finie dans .env)</span></span>
<span class="line">        <span class="token comment"># pour nous en servir dans Doctrine.</span></span>
<span class="line">        <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">&#39;%env(resolve:DATABASE_URL)%&#39;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># IMPORTANT: You MUST configure your server version,</span></span>
<span class="line">        <span class="token comment"># either here or in the DATABASE_URL env var (see .env file)</span></span>
<span class="line">        <span class="token comment">#server_version: &#39;13&#39;</span></span>
<span class="line">    <span class="token comment"># Cette section va configurer l&#39;ORM (Object-Relational mapping ou Mapping objet-relationnel).</span></span>
<span class="line">    <span class="token comment"># C&#39;est √† dire l&#39;outil faisant le lien entre nos objets PHP et nos tables (le coeur de Doctrine en somme)</span></span>
<span class="line">    <span class="token key atrule">orm</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># Doctrine va g√©n√©rer des classes &quot;proxy&quot; servant √† g√©rer plus rapidement les objets (en ajoutant des m√©thodes sp√©cifiques pour son usage, comme g√©rer le cache par exemple)</span></span>
<span class="line">        <span class="token key atrule">auto_generate_proxy_classes</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token comment"># Ce param√®tre d√©fini comment Doctrine convertit le nom d&#39;une classe en un nom de table (et m√™me chose pour les noms de propri√©t√©s en noms de champs)</span></span>
<span class="line">        <span class="token key atrule">naming_strategy</span><span class="token punctuation">:</span> doctrine.orm.naming_strategy.underscore_number_aware</span>
<span class="line">        <span class="token comment"># On indique √† Doctrine qu&#39;on veut qu&#39;il d√©tecte nos entit√©s (objets √† convertir en tables) automatiquement</span></span>
<span class="line">        <span class="token key atrule">auto_mapping</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token comment"># On lui indique quand m√™me sur quels dossiers il doit travailler et comment les lire</span></span>
<span class="line">        <span class="token key atrule">mappings</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># Ici, nous pouvons donner √† Doctrine plusieurs dossiers o√π se trouvent des entit√©s</span></span>
<span class="line">            <span class="token comment"># Cette section sert surtout si vous utilisez une structure personnalis√©e (ce que nous n&#39;allons pas faire ;) ).</span></span>
<span class="line">            <span class="token key atrule">App</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token comment"># Un param√®tre historique de Symfony, nous n&#39;en tiendrons pas compte. Il servait en Symfony 2 et 3 (nous voyons la version 5)</span></span>
<span class="line">                <span class="token key atrule">is_bundle</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">                <span class="token comment"># Nous indiquons que notre mapping (les indications des types des champs par exemple) est fait √† l&#39;aide d&#39;annotations (il est possible de le faire en Yaml ou en Xml, mais ces m√©thodes sont d√©pr√©ci√©es)</span></span>
<span class="line">                <span class="token key atrule">type</span><span class="token punctuation">:</span> annotation</span>
<span class="line">                <span class="token comment"># Nous indiquons dans quel dossier chercher nos entit√©s. %kernel.project_dir% est un param√®tre, toujours d√©fini dans Symfony, vous permettant de r√©cup√©rer le chemin vers la racine du projet. On s&#39;en sert surtout dans les configurations des packages (d√©pendances ou librairies que l&#39;on charge avec Composer dans notre projet)</span></span>
<span class="line">                <span class="token key atrule">dir</span><span class="token punctuation">:</span> <span class="token string">&#39;%kernel.project_dir%/src/Entity&#39;</span></span>
<span class="line">                <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token string">&#39;App\Entity&#39;</span></span>
<span class="line">                <span class="token key atrule">alias</span><span class="token punctuation">:</span> App</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="creer-des-entites" tabindex="-1"><a class="header-anchor" href="#creer-des-entites"><span>Cr√©er des entit√©s</span></a></h2><p>Une entit√© est une classe PHP (rang√©e, dans notre cas, dans le dossier <code>src/Entity</code>) qui va correspondre √† une table de notre BdD. Chaque ligne de cette table correspondra √† un objet.</p><p>Pour faire sch√©matique :</p><ul><li>Classe = table</li><li>Objet = ligne de cette table</li></ul><p>Nous allons cr√©er 2 entit√©s :</p><ul><li><code>Article</code> un article de blog, contenant un titre (string de 255 caract√®res), un contenu (text) et une cat√©gorie (Tag)</li><li><code>Tag</code> une cat√©gorie, contenant un nom (string de 128 caract√®res), qui peut √™tre li√©e √† plusieurs articles</li></ul><p>Pour cr√©er ces objets, nous avons 2 choix :</p><ul><li>les √©crire nous-m√™me</li><li>les g√©n√©rer √† l&#39;aide de la commande <code>php bin/console make:entity</code></li></ul><p>Je vous conseille toujours le second choix üòâ.</p><p>Dans un premier temps, cr√©ons la classe <code>Article</code>.</p><ul><li>On ex√©cute la commande</li><li>On pr√©cise le nom de la classe qu&#39;on veut cr√©er : <code>Article</code></li><li>Puis on ajoute nos champs <ul><li><code>title</code> de type string, longueur 255 et non <code>null</code></li><li><code>content</code> de type text et non <code>null</code></li></ul></li><li>Arr√™tons-nous ici pour cette entit√©. Nous ajouterons la relation avec Tag en cr√©ant cette entit√©.</li></ul><p>Cr√©ons la classe <code>Tag</code></p><ul><li>On ex√©cute la commande</li><li>On pr√©cise le nom de la classe qu&#39;on veut cr√©er : <code>Tag</code></li><li>Puis on ajoute nos champs <ul><li><code>name</code> de type string, longueur 128 et non <code>null</code></li><li><code>articles</code> de type relation (nous serons ainsi guid√©s pour choisir le type de relation, ici nous voulons du <code>OneToMany</code> : 1 Tag li√© √† n Articles) <ul><li>La commande nous propose √©galement de cr√©er un champ <code>tag</code> dans <code>Article</code>. Profitons-en, √ßa pourra nous servir !</li><li>La commande nous demande √©galement si la propri√©t√© <code>tag</code> de <code>Article</code> peut √™tre null. Disons que non (nos articles doivent obligatoirement avoir une cat√©gorie).</li><li>Contrairement √† la vid√©o, √† la question d&#39;activer <code>orphanRemoval</code> sur cette relation, dire non.</li><li>La relation est ajout√©e !</li><li>Valider une derni√®re fois pour terminer les modifications</li></ul></li></ul></li></ul><p>Nous avons maintenant 4 fichiers cr√©√©s, dont ces 2 entit√©s : <code>src/Entity/Tag.php</code></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Entity</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>TagRepository</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Common<span class="token punctuation">\</span>Collections<span class="token punctuation">\</span>ArrayCollection</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Common<span class="token punctuation">\</span>Collections<span class="token punctuation">\</span>Collection</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>Mapping</span> <span class="token keyword">as</span> <span class="token constant">ORM</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Entity</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">repositoryClass</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">TagRepository</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Tag</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Id</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>GeneratedValue</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;integer&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$id</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">length</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>OneToMany</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">targetEntity</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">Article</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">mappedBy</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;tag&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$articles</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">articles</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token keyword return-type">int</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setName</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@return</span> <span class="token class-name">Collection<span class="token punctuation">|</span>Article<span class="token punctuation">[</span><span class="token punctuation">]</span></span></span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getArticles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Collection</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">articles</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">addArticle</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Article</span> <span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">articles</span><span class="token operator">-&gt;</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">articles</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$article</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$article</span><span class="token operator">-&gt;</span><span class="token function">setTag</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">removeArticle</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Article</span> <span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">articles</span><span class="token operator">-&gt;</span><span class="token function">removeElement</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// set the owning side to null (unless already changed)</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$article</span><span class="token operator">-&gt;</span><span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token variable">$article</span><span class="token operator">-&gt;</span><span class="token function">setTag</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>src/Entity/Article.php</code></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Entity</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>ArticleRepository</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>Mapping</span> <span class="token keyword">as</span> <span class="token constant">ORM</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Entity</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">repositoryClass</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">ArticleRepository</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Article</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Id</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>GeneratedValue</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;integer&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$id</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">length</span><span class="token punctuation">:</span> <span class="token number">255</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$title</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;text&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$content</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>ManyToOne</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">targetEntity</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">Tag</span><span class="token operator">::</span><span class="token constant">class</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">inversedBy</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;articles&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>JoinColumn</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">nullable</span><span class="token punctuation">:</span> <span class="token attribute-class-name class-name">false</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$tag</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token keyword return-type">int</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">title</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setTitle</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$title</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">title</span> <span class="token operator">=</span> <span class="token variable">$title</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">content</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setContent</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">content</span> <span class="token operator">=</span> <span class="token variable">$content</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token class-name return-type">Tag</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tag</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setTag</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token class-name type-declaration">Tag</span> <span class="token variable">$tag</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">self</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tag</span> <span class="token operator">=</span> <span class="token variable">$tag</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gerer-les-heritages-entre-les-objets" tabindex="-1"><a class="header-anchor" href="#gerer-les-heritages-entre-les-objets"><span>G√©rer les h√©ritages entre les objets</span></a></h3><p><a href="https://www.doctrine-project.org/projects/doctrine-orm/en/2.11/reference/inheritance-mapping.html" target="_blank" rel="noopener noreferrer">La documentation Doctrine sur l&#39;h√©ritage</a></p><p>Si vous avez des h√©ritages entre vos tables / vos entit√©s, il faut ajouter quelques annotations / attributs pour pr√©venir Doctrine et lui expliquer comment les g√©rer.</p><p>Il y a 3 types d&#39;h√©ritages :</p><ul><li><a href="https://www.doctrine-project.org/projects/doctrine-orm/en/2.11/reference/inheritance-mapping.html#mapped-superclasses" target="_blank" rel="noopener noreferrer">Une classe par entit√© fille (Mapped Superclasses)</a>, avec les champs de la classe parente r√©p√©t√©s dans chacune, pour r√©duire le nombre de jointures</li><li><a href="https://www.doctrine-project.org/projects/doctrine-orm/en/2.11/reference/inheritance-mapping.html#single-table-inheritance" target="_blank" rel="noopener noreferrer">Une table pour toutes les entit√©s</a>, pour r√©duire le nombre de tables et de jointures</li><li><a href="https://www.doctrine-project.org/projects/doctrine-orm/en/2.11/reference/inheritance-mapping.html#class-table-inheritance" target="_blank" rel="noopener noreferrer">Une table par entit√©, y compris la parente</a>, pour r√©duire la r√©p√©tition de donn√©es (solution que je pr√©f√®re le plus souvent)</li></ul><h4 id="mapped-superclasses" tabindex="-1"><a class="header-anchor" href="#mapped-superclasses"><span>Mapped Superclasses</span></a></h4><p>Avec cette strat√©gie, on ne cr√©e que des tables utiles et on √©vite de devoir faire des jointures pour r√©cup√©rer les donn√©es. Par contre, on duplique une information qui pourrait √™tre factoris√©e.</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>MappedSuperclass</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Person</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;integer&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token variable">$mapped1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;string&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token variable">$mapped2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Entity</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Employee</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Id</span></span><span class="token delimiter punctuation">]</span></span> </span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;integer&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span> </span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$id</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Column</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;string&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Le script va alors cr√©er une seule table <code>Employee</code>, contenant les propri√©t√©s de <code>Employee</code> et de <code>Person</code> :</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Employee <span class="token punctuation">(</span></span>
<span class="line">    mapped1 <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> </span>
<span class="line">    mapped2 <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> </span>
<span class="line">    id <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> </span>
<span class="line">    name <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> </span>
<span class="line">    related1_id <span class="token keyword">INTEGER</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> </span>
<span class="line">    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="single-table-inheritance" tabindex="-1"><a class="header-anchor" href="#single-table-inheritance"><span>Single Table Inheritance</span></a></h4><p>Dans cette strat√©gie, on ne va cr√©er qu&#39;une seule table pour nos deux entit√©s, avec les propri√©t√©s cumul√©es de <code>Person</code> et de toutes ses classes filles. Noter ici la partie <code>DiscriminatorColumn</code>, qui d√©finit une colonne suppl√©mentaire pour distinguer les objets <code>Person</code>, des objets <code>Employee</code> (la propri√©t√© <code>DiscriminatorMap</code> permet de d√©finir les valeurs qui iront dans cette colonne)</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Entity</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>InheritanceType</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;SINGLE_TABLE&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>DiscriminatorColumn</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;discr&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;string&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>DiscriminatorMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;person&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Person&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;employee&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Employee&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Person</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Entity</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Employee</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="class-table-inheritance" tabindex="-1"><a class="header-anchor" href="#class-table-inheritance"><span>Class Table Inheritance</span></a></h4><p>Cette strat√©gie permet de cr√©er une table par entit√©, dont l&#39;entit√© parente (<code>Person</code>) et une jointure sera faite par Doctrine pour r√©cup√©rer les √©l√©ments des tables n√©cessaires. Noter ici la partie <code>DiscriminatorColumn</code>, qui d√©finit une colonne suppl√©mentaire pour distinguer les objets <code>Person</code>, des objets <code>Employee</code> (la propri√©t√© <code>DiscriminatorMap</code> permet de d√©finir les valeurs qui iront dans cette colonne).</p><p>Cette mani√®re de faire permet d&#39;√©viter les r√©p√©titions dans les tables ou les donn√©es vides dans la table. C&#39;est en g√©n√©ral la solution recommand√©e si vous utilisez <a href="https://fr.wikipedia.org/wiki/Merise_(informatique)#MCD_:_mod%C3%A8le_conceptuel_des_donn%C3%A9es" target="_blank" rel="noopener noreferrer">la m√©thode Merise pour cr√©er votre MCD</a>.</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Entity</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>InheritanceType</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;JOINED&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>DiscriminatorColumn</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;discr&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">type</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;string&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>DiscriminatorMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;person&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Person&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;employee&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Employee&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Person</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name class-name-fully-qualified">ORM<span class="token punctuation">\</span>Entity</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Employee</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="les-migrations" tabindex="-1"><a class="header-anchor" href="#les-migrations"><span>Les migrations</span></a></h2><p>Si vous n&#39;avez pas cr√©√© la BdD, Symfony met √† votre disposition une commande pour le faire :</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">php bin/console doctrine:database:create</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Lorsque nous cr√©ons des entit√©s, nous voulons que nos changements apparaissent dans notre BdD (tel √©tait notre objectif, au d√©part). Pour cela, nous avons plusieurs moyens, mais le plus propre d&#39;entre eux est de cr√©er des migrations.</p><p>Une migration contient 2 ensemble de requ√™tes SQL, pour vous permettre de passer d&#39;une version √† l&#39;autre de votre BdD. Son nom contient la date pr√©cise o√π vous l&#39;avez g√©n√©r√©e et permet ainsi de savoir dans quel ordre les migrations doivent √™tre ex√©cut√©es.</p><p>Elle contient 2 m√©thodes :</p><ul><li><code>up</code> : les requ√™tes √† ex√©cuter pour mettre √† jour la base</li><li><code>down</code> : les requ√™tes √† ex√©cuter pour annuler ces modifications (on s&#39;en sert principalement en cas de probl√®mes)</li></ul><p>Pour g√©n√©rer une migration, il faut utiliser la commande (j&#39;ajoute l&#39;option <code>-n</code> pour √©viter que la ligne de commande demande une confirmation) :</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">php bin/console make:migration</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>La commande <code>php bin/console doctrine:migrations:diff -n</code> fait exactement la m√™me chose.</p><p>‚ö†Ô∏è <strong>Conseil</strong> : il peut √™tre utile d&#39;ex√©cuter les migrations <em>avant</em> d&#39;en g√©n√©rer une nouvelle en ex√©cutant <code>php bin/console doctrine:migrations:migrate -n</code> avant la commande <code>make:migration</code> / <code>doctrine:migrations:diff</code></p><p>Dans notre exemple, notre migration ressemblera √† ceci :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">DoctrineMigrations</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>DBAL<span class="token punctuation">\</span>Schema<span class="token punctuation">\</span>Schema</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Migrations<span class="token punctuation">\</span>AbstractMigration</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Auto-generated Migration: Please modify to your needs!</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">Version20210226082708</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMigration</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">up</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Schema</span> <span class="token variable">$schema</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// this up() migration is auto-generated, please modify it to your needs</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">addSql</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;CREATE TABLE article (id INT AUTO_INCREMENT NOT NULL, tag_id INT NOT NULL, title VARCHAR(255) NOT NULL, content LONGTEXT NOT NULL, INDEX IDX_23A0E66BAD26311 (tag_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">addSql</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;CREATE TABLE tag (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(128) NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">addSql</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;ALTER TABLE article ADD CONSTRAINT FK_23A0E66BAD26311 FOREIGN KEY (tag_id) REFERENCES tag (id)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">down</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Schema</span> <span class="token variable">$schema</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// this down() migration is auto-generated, please modify it to your needs</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">addSql</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;ALTER TABLE article DROP FOREIGN KEY FK_23A0E66BAD26311&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">addSql</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;DROP TABLE article&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">addSql</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;DROP TABLE tag&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Pour ex√©cuter les migrations :</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">php bin/console doctrine:migrations:migrate <span class="token parameter variable">-n</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Cette commande ex√©cutera toutes les migrations qui n&#39;ont pas d√©j√† √©t√© lanc√©es (la liste des migrations d√©j√† ex√©cut√©es se trouve dans la table <code>doctrine_migration_versions</code> de votre BdD).</p><p>‚ö†Ô∏è <strong>Conseil :</strong> Il est important que votre base puisse √™tre construite de 0 avec les migrations (et √©ventuellement des fixtures). Vous pouvez tester</p><h3 id="annuler-une-migration" tabindex="-1"><a class="header-anchor" href="#annuler-une-migration"><span>Annuler une migration</span></a></h3><p>Si une migration s&#39;est mal pass√©e (une erreur s&#39;est produite pendant la migration ou cr√©e un bug, par exemple), vous pouvez l&#39;annuler avec la commande <code>php bin/console doctrine:migrations:execute --down DoctrineMigrations\VersionXXX</code> o√π <code>XXX</code> est le num√©ro de version (dans les faits, on passe le FQCN de la migration √† la commande).</p><h2 id="l-entitymanager-pour-sauvegarder" tabindex="-1"><a class="header-anchor" href="#l-entitymanager-pour-sauvegarder"><span>L&#39;EntityManager pour sauvegarder</span></a></h2><p>Maintenant que nous avons notre sch√©ma de BdD (nos tables et nos colonnes), voyons comment ajouter des entr√©es dans nos tables. Nous allons le faire depuis un controller, mais sachez que ce fonctionnement peut √™tre utilis√© dans n&#39;importe quel service (classe se trouvant dans <code>src</code>, en dehors de notre dossier <code>src/Entity</code>).</p><p>Un exemple d√©taill√© d&#39;utilisation :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Article</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Tag</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>EntityManagerInterface</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FrameworkBundle<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractController</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>Route</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/blog&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;blog_&quot;</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">BlogController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/fixtures&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;fixtures&quot;</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">fixtures</span><span class="token punctuation">(</span><span class="token class-name type-declaration">EntityManagerInterface</span> <span class="token variable">$entityManager</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// On cr√©e un objet Tag (nous n&#39;en avons actuellement aucun)</span></span>
<span class="line">        <span class="token variable">$tag</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$tag</span><span class="token operator">-&gt;</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;animaux&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// On cr√©e un premier article et on donne des valeurs √† ses diff√©rents champs</span></span>
<span class="line">        <span class="token variable">$article</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$article</span><span class="token operator">-&gt;</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Les animaux fantastiques&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$article</span><span class="token operator">-&gt;</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Un contenu fabuleux pour un article fantastique&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// Ici, on fait le lien entre notre article et le tag que nous avons d√©fini plus haut.</span></span>
<span class="line">        <span class="token comment">// Doctrine se chargera de retranscrire ce lien dans la BdD.</span></span>
<span class="line">        <span class="token comment">// Dans les faits, il mettra l&#39;id de notre tag dans la colonne tag_id de notre article.</span></span>
<span class="line">        <span class="token variable">$article</span><span class="token operator">-&gt;</span><span class="token function">setTag</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Ici, on dit √† l&#39;entity manager qu&#39;il devra sauvegarder nos deux entit√©s. Vous pouvez voir ce persist que le add de Git</span></span>
<span class="line">        <span class="token comment">// Noter qu&#39;il faut appeler la m√©thode persist sur chacun de nos objets</span></span>
<span class="line">        <span class="token comment">// Il est possible de ne le faire qu&#39;une fois, mais c&#39;est une astuce que vous verrez plus tard ;)</span></span>
<span class="line">        <span class="token variable">$entityManager</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$entityManager</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Noter que les entr√©es n&#39;existent pas encore en base.</span></span>
<span class="line">        <span class="token comment">// Elles n&#39;existent qu&#39;une fois que nous appelons la m√©thode flush de l&#39;entity manager.</span></span>
<span class="line">        <span class="token comment">// Vous pouvez voir la m√©thode persist comme le commit de Git.</span></span>
<span class="line">        <span class="token variable">$entityManager</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Ici, j&#39;ai choisi de rediriger vers l&#39;accueil du blog</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;blog_index&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Pour supprimer une entit√© de la base, utiliser la m√©thode <code>remove</code> :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token variable">$entityManager</span><span class="token operator">-&gt;</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token variable">$entityManager</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Il faut donc bien retenir le fonctionnement des m√©thodes <code>persist</code> et <code>flush</code> qui font tout le travail.</p><h2 id="le-paramconverter-de-doctrine" tabindex="-1"><a class="header-anchor" href="#le-paramconverter-de-doctrine"><span>Le ParamConverter de Doctrine</span></a></h2><p>La <a href="https://symfony.com/doc/current/doctrine.html#automatically-fetching-objects-paramconverter" target="_blank" rel="noopener noreferrer">documentation officielle</a> La <a href="https://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/annotations/converters.html" target="_blank" rel="noopener noreferrer">documentation des ParamConverter</a></p><p>Dans un controller, vous pouvez utiliser les param√®tres de votre route pour r√©cup√©rer directement une entit√© (une ligne de votre table)</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/{id}&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;show&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">show</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Article</span> <span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;blog/show.html.twig&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;article&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$article</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Pour appeler cette route, il suffira de faire :</p><div class="language-twig line-numbers-mode" data-highlighter="prismjs" data-ext="twig" data-title="twig"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token twig language-twig"><span class="token delimiter punctuation">{{</span> path<span class="token punctuation">(</span><span class="token string"><span class="token punctuation">&#39;</span>show<span class="token punctuation">&#39;</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>id<span class="token punctuation">:</span> entity<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Un lien vers ma page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Dans l&#39;exemple ci-dessus, notre route contient un param√®tre <code>id</code>, et nous demandons √† Symfony de la convertir en un objet <code>Article</code>. Pour cela, Doctrine va utiliser ce que l&#39;on appelle un ParamConverter (un objet qui converti les param√®tres d&#39;une route/action). Dans les faits, il va v√©rifier si le nom du param√®tre de la route correspond √† une propri√©t√© de l&#39;objet. Si c&#39;est le cas, il va faire une requ√™te <code>SELECT</code> sur la table <code>article</code> pour r√©cup√©rer l&#39;entr√©e correspondante (avec un <code>WHERE id = $id</code>, en somme).</p><h2 id="le-repository-pour-recuperer-des-entites" tabindex="-1"><a class="header-anchor" href="#le-repository-pour-recuperer-des-entites"><span>Le Repository pour r√©cup√©rer des entit√©s</span></a></h2><p>La <a href="https://symfony.com/doc/current/doctrine.html#doctrine-queries" target="_blank" rel="noopener noreferrer">documentation sur les Repositories</a></p><p>Un objet Repository est li√© √† une entit√© pr√©cise et permet de faire des requ√™tes <code>SELECT</code> sur la table li√©e.</p><p>Dans l&#39;exemple pr√©c√©dent, le ParamConverter utilise une m√©thode pratique et commune √† tous les Repositories : <code>find($id)</code>. Il y a 4 m√©thodes disponibles dans tous les repositories, d√©taillons-les :</p><h3 id="findall" tabindex="-1"><a class="header-anchor" href="#findall"><span><code>findAll()</code></span></a></h3><p><code>findAll()</code> r√©cup√®re tous les objets de la table (<code>SELECT * FROM article</code> par exemple)</p><h3 id="find-id" tabindex="-1"><a class="header-anchor" href="#find-id"><span><code>find($id)</code></span></a></h3><p>Find prend en param√®tre un identifiant (colonne <code>id</code> d&#39;une table) et renvoie l&#39;objet correspondant (<code>SELECT * FROM article WHERE id = $id</code> par exemple)</p><h3 id="findoneby-array-criteria-array-orderby-null" tabindex="-1"><a class="header-anchor" href="#findoneby-array-criteria-array-orderby-null"><span><code>findOneBy(array $criteria, array $orderBy = null)</code></span></a></h3><p><code>findOneBy(array $criteria, array $orderBy = null)</code> prend 2 param√®tres, un tableau de crit√®res (les colonnes et les valeurs √† mettre dans un <code>WHERE</code>) et un tableau pour ordonner (avec la colonne et l&#39;ordre) et renvoie <strong>un</strong> objet correspondant aux crit√®res (<code>SELECT * FROM article WHERE title = $title ORDER BY id DESC LIMIT 1</code> par exemple).</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * On r√©cup√®re le param√®tre title de notre route</span>
<span class="line">     * et on injecte le repository dont nous allons avoir besoin.</span>
<span class="line">     * </span>
<span class="line">     * Noter que l&#39;on aurait pu utiliser le ParamConverter de Doctrine pour r√©cup√©rer plus simplement l&#39;article par son titre</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/{title}&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;blog_show&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">show</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">ArticleRepository</span> <span class="token variable">$repository</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// On r√©cup√®re plusieurs articles</span></span>
<span class="line">        <span class="token variable">$article</span> <span class="token operator">=</span> <span class="token variable">$repository</span><span class="token operator">-&gt;</span><span class="token function">findOneBy</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">            <span class="token comment">// On passe un tableau de crit√®res, ne contenant qu&#39;une entr√©e :</span></span>
<span class="line">            <span class="token comment">// on cherche dans la colonne title de la table, avec la valeur $title</span></span>
<span class="line">            <span class="token comment">// Ce qui revient √† faire en SQL : WHERE title = &#39;$title&#39;</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;title&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$title</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;blog/index.html.twig&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;article&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$article</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="findby-array-criteria-array-orderby-null-limit-null-offset-null" tabindex="-1"><a class="header-anchor" href="#findby-array-criteria-array-orderby-null-limit-null-offset-null"><span><code>findBy(array $criteria, array $orderBy = null, $limit = null, $offset = null)</code></span></a></h3><p><code>findBy(array $criteria, array $orderBy = null, $limit = null, $offset = null)</code> : prend 4 param√®tres, un tableau de crit√®res, un tableau pour ordonner, la quantit√© maximum d&#39;objets √† retourner (<code>LIMIT</code> en SQL), et le premier √©l√©ment √† retourner (premier param√®tre de <code>LIMIT</code>) (<code>SELECT * FROM article WHERE title = $title ORDER BY id DESC LIMIT 0,5</code> par exemple).</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * On r√©cup√®re le param√®tre title de notre route</span>
<span class="line">     * et on injecte le repository dont nous allons avoir besoin.</span>
<span class="line">     * </span>
<span class="line">     * Noter que l&#39;on aurait pu utiliser le ParamConverter de Doctrine pour r√©cup√©rer plus simplement l&#39;article par son titre</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/{tag}&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;blog_index&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$tag</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">ArticleRepository</span> <span class="token variable">$repository</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// On r√©cup√®re plusieurs articles</span></span>
<span class="line">        <span class="token variable">$articles</span> <span class="token operator">=</span> <span class="token variable">$repository</span><span class="token operator">-&gt;</span><span class="token function">findBy</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">            <span class="token comment">// On passe un tableau de crit√®res, ne contenant qu&#39;une entr√©e :</span></span>
<span class="line">            <span class="token comment">// on cherche dans la colonne tag de la table, avec la valeur $tag</span></span>
<span class="line">            <span class="token comment">// Ce qui revient √† faire en SQL : WHERE tag = &#39;$tag&#39;</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;tag&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$tag</span><span class="token punctuation">,</span>  </span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token comment">// On pr√©cise comment trier les r√©sultats</span></span>
<span class="line">            <span class="token comment">// Ce qui revient √† faire en SQL : ORDER BY id DESC</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;id&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;DESC&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// On veut r√©cup√©rer 5 r√©sultats maximum</span></span>
<span class="line">        <span class="token number">0</span> <span class="token comment">// On commence au premier enregistrement, nous avons donc l&#39;√©quivalent de LIMIT 0,5</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;blog/index.html.twig&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;articles&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$articles</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="le-querybuilder-construire-ses-propres-requetes" tabindex="-1"><a class="header-anchor" href="#le-querybuilder-construire-ses-propres-requetes"><span>Le QueryBuilder : construire ses propres requ√™tes</span></a></h3><p>La <a href="https://symfony.com/doc/current/doctrine.html#querying-with-the-query-builder" target="_blank" rel="noopener noreferrer">documentation sur le QueryBuilder</a></p><p>Nous allons presque toujours utiliser le QueryBuilder pour faire nos requ√™tes. Il s&#39;agit d&#39;un objet permettant de g√©rer des requ√™tes complexes, sans avoir √† taper une requ√™te SQL complexe, et d&#39;utiliser la puissance de PHP (boucles, conditions, etc.) pour les construire. Prenons l&#39;exemple fourni lorsqu&#39;on g√©n√®re un Repository :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">findByExampleField</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// On cr√©e un objet QueryBuilder, en mettant &quot;a&quot; comme alias de notre table article</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a&#39;</span><span class="token punctuation">)</span> </span>
<span class="line">            <span class="token comment">// On ajoute un WHERE, avec un param√®tre &quot;:val&quot;</span></span>
<span class="line">            <span class="token comment">// (voir le cours sur PDO et les param√®tres nomm√©s)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">andWhere</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a.exampleField = :val&#39;</span><span class="token punctuation">)</span> </span>
<span class="line">            <span class="token comment">// On donne une valeur au param√®tre. </span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;val&#39;</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> </span>
<span class="line">            <span class="token comment">// On trie nos √©l√©ments par &quot;id&quot; croissant</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a.id&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;ASC&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// On ne veut que 10 r√©sultats maximum </span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">setMaxResults</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> </span>
<span class="line">            <span class="token comment">// On r√©cup√®re la requ√™te g√©n√©r√©e, qui va correspondre √† quelque chose comme</span></span>
<span class="line">            <span class="token comment">// &quot;SELECT * FROM article a WHERE a.exampleField = &#39;$value&#39; ORDER BY a.id LIMIT 10&quot;</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </span>
<span class="line">            <span class="token comment">// On ex√©cute la requ√™te et on r√©cup√®re les r√©sultats.</span></span>
<span class="line">            <span class="token comment">// On les retourne sous la forme d&#39;un tableau (qui contient des objets Article)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </span>
<span class="line">        <span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Voyons comment ajouter une condition dans cet exemple :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">    <span class="token comment">// On ajoute un param√®tre $inverseOrder : s&#39;il vaut true, nous allons trier par ordre d√©croissant</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">findByExampleField</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$inverseOrder</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// On cr√©e un objet QueryBuilder, en mettant &quot;a&quot; comme alias de notre table article</span></span>
<span class="line">        <span class="token variable">$qb</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// On ajoute un WHERE, avec un param√®tre &quot;:val&quot; (voir le cours sur PDO et les param√®tres nomm√©s)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">andWhere</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a.exampleField = :val&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// On donne une valeur au param√®tre. </span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;val&#39;</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// On ne veut que 10 r√©sultats maximum</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">setMaxResults</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$inverseOrder</span> <span class="token operator">===</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// On tri nos √©l√©ments par &quot;id&quot; d√©croissant</span></span>
<span class="line">            <span class="token variable">$qb</span><span class="token operator">-&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a.id&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;DESC&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// On tri nos √©l√©ments par &quot;id&quot; croissant</span></span>
<span class="line">            <span class="token variable">$qb</span><span class="token operator">-&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a.id&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;ASC&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$qb</span></span>
<span class="line">            <span class="token comment">// On r√©cup√®re la requ√™te g√©n√©r√©e, qui va correspondre √† quelque chose comme</span></span>
<span class="line">            <span class="token comment">// &quot;SELECT * FROM article a WHERE a.exampleField = &#39;$value&#39; ORDER BY a.id LIMIT 10&quot;</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// On ex√©cute la requ√™te et on r√©cup√®re les r√©sultats.</span></span>
<span class="line">            <span class="token comment">// On les retourne sous la forme d&#39;un tableau (qui contient des objets Article)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ces QueryBuilders et les diff√©rentes m√©thodes de notre repository nous permettent de conserver les requ√™tes courantes en un point, et de ne pas avoir √† les r√©√©crire.</p><h3 id="les-jointures" tabindex="-1"><a class="header-anchor" href="#les-jointures"><span>Les jointures</span></a></h3><p>Imaginons que nous voulons cr√©er un moteur de recherche pour notre blog et que nous voulons chercher √† la fois dans les titres d&#39;article, dans leur contenu, mais aussi dans les noms du tag associ√©. Dans ce cas, nous voulons faire notre recherche sur 2 tables, simultan√©ment. Pour cela, nous allons utiliser une jointure :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">search</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$text</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// On cr√©e un objet QueryBuilder, en mettant &quot;a&quot; comme alias de notre table article</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a&#39;</span><span class="token punctuation">)</span> </span>
<span class="line">            <span class="token comment">// Ici, on suit les propri√©t√©s de notre entit√© :</span></span>
<span class="line">            <span class="token comment">// on demande √† Doctrine une jointure sur la propri√©t√© tag de notre article</span></span>
<span class="line">            <span class="token comment">// (il se d√©brouille ensuite pour faire la correspondance par id),</span></span>
<span class="line">            <span class="token comment">// et on lui dit de l&#39;appeler t dans la suite de la requ√™te</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a.tag&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;t&#39;</span><span class="token punctuation">)</span> </span>
<span class="line">            <span class="token comment">// On ajoute un WHERE, avec un param√®tre &quot;:val&quot;</span></span>
<span class="line">            <span class="token comment">// (voir le cours sur PDO et les param√®tres nomm√©s)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a.content LIKE :val&#39;</span><span class="token punctuation">)</span> </span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;a.title LIKE :val&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// On peut ensuite utiliser notre table t (les tags) pour regarder le champ name</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;t.name LIKE :val&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// On donne une valeur au param√®tre.</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;val&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;%&#39;</span><span class="token operator">.</span><span class="token variable">$text</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;%&#39;</span><span class="token punctuation">)</span> </span>
<span class="line">            <span class="token comment">// On r√©cup√®re la requ√™te g√©n√©r√©e</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// On ex√©cute la requ√™te et on r√©cup√®re les r√©sultats.</span></span>
<span class="line">            <span class="token comment">// On les retourne sous la forme d&#39;un tableau (qui contient des objets Article)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </span>
<span class="line">        <span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Nous avons donc r√©cup√©r√© des objets Article gr√¢ce √† notre recherche sur 3 colonnes diff√©rentes (dans 2 tables diff√©rentes !).</p><h3 id="les-differentes-methodes-du-querybuilder" tabindex="-1"><a class="header-anchor" href="#les-differentes-methodes-du-querybuilder"><span>Les diff√©rentes m√©thodes du <code>QueryBuilder</code></span></a></h3><ul><li><code>select()</code> remplace le contenu de la clause <code>SELECT</code> de la requ√™te. Prend une chaine de caract√®res ou un tableau.</li><li><code>addSelect()</code> ajoute des √©l√©ments √† la clause <code>SELECT</code> de la requ√™te. Prend une chaine de caract√®res ou un tableau.</li><li><code>where()</code>, <code>orWhere()</code>, <code>andWhere()</code> pour g√©rer la clause <code>WHERE</code> de la requ√™te (la premi√®re remplace). Prend une chaine de caract√®res.</li><li><code>setParameter()</code> pour d√©finir la valeur d&#39;un param√®tre (d√©fini avec <code>:nomDeLaVariable</code>). Prend 2 param√®tres : le nom de la variable (sans les <code>:</code>) et en second, la valeur (peut √™tre une variable, ou non)</li><li><code>join()</code>, <code>innerJoin()</code>, <code>leftJoin()</code> pour cr√©er une jointure avec une table. Prend le nom de la propri√©t√© √† &quot;suivre&quot; (dans notre exemple <code>a.tags</code> pour joindre la table <code>tag</code>) et en second param√®tre, l&#39;alias de la table jointe (<code>t</code> par exemple).</li><li><code>orderBy()</code>, <code>addOrderBy()</code> pour g√©rer la clause <code>ORDER BY</code> de la requ√™te. Prend 2 param√®tres : la propri√©t√© sur laquelle appliquer le tri et en second, le sens du tri <code>ASC</code> ou <code>DESC</code>.</li><li><code>setMaxResults()</code> pour g√©rer la clause <code>LIMIT</code> (limit) de la requ√™te. Prend le nombre d&#39;√©l√©ments √† r√©cup√©rer.</li><li><code>setFirstResult()</code> pour g√©rer la clause <code>LIMIT</code> (offset) de la requ√™te. Prend le num√©ro (index√© en 0) du premier √©l√©ment √† afficher.</li><li><code>getQuery()</code> r√©cup√®re les diff√©rentes clauses entr√©es et cr√©e la requ√™te DQL et la requ√™te SQL qui va √™tre appliqu√©e.</li></ul><p>√Ä partir de la <code>Query</code> (retourn√©e par <code>getQuery()</code>), nous avons plusieurs moyens de r√©cup√©rer nos r√©sultats :</p><ul><li><code>getResult()</code> retourne les r√©sultats de la requ√™te sous la forme d&#39;un tableau d&#39;objets.</li><li><code>getSingleResult()</code> retourne un seul r√©sultat. Si la requ√™te en renvoie plusieurs ou aucun, une exception sera lev√©e.</li><li><code>getOneOrNullResult()</code> retourne aucun ou un seul r√©sultat (null ou un objet). Si la requ√™te en renvoie plusieurs, une exception sera lev√©e.</li><li><code>getScalarResult()</code> retourne un tableau de nombres (si vous avez une requ√™te avec uniquement des <code>COUNT</code> ou √©quivalent dans la clause <code>SELECT</code>).</li><li><code>getSingleScalarResult()</code> retourne un nombre (si vous avez une requ√™te avec uniquement un <code>COUNT</code> ou √©quivalent dans la clause <code>SELECT</code>).</li></ul><h2 id="tester-nos-requetes" tabindex="-1"><a class="header-anchor" href="#tester-nos-requetes"><span>Tester nos requ√™tes</span></a></h2><p>En g√©n√©ral, nous allons vouloir utiliser nos Repositories dans d&#39;autres services (classes en dehors de <code>src/Entity</code>). Pour tester nos requ√™tes, nous pouvons par exemple appeler notre Repository dans un Controller :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// src/Controller/BlogController.php</span></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>ArticleRepository</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FrameworkBundle<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractController</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>Route</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">BlogController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span> </span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/blog/search/{text}&quot;</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;blog_search&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">search</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ArticleRepository</span> <span class="token variable">$repo</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$articles</span> <span class="token operator">=</span> <span class="token variable">$repo</span><span class="token operator">-&gt;</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// Cette fonction va afficher la variable $articles et son contenu</span></span>
<span class="line">        <span class="token comment">// (un peu comme un var_dump(), mais en plus beau et plus pratique) dans le profiler de Symfony</span></span>
<span class="line">        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$articles</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span>
<span class="line">        <span class="token comment">// Cette fonction va afficher la variable $articles et son contenu,</span></span>
<span class="line">        <span class="token comment">// mais aussi arr√™ter le programme (dump and die) (comme un exit(var_dump()))</span></span>
<span class="line">        <span class="token function">dd</span><span class="token punctuation">(</span><span class="token variable">$articles</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;blog/search.html.twig&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;results&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$articles</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="creer-de-fausses-donnees-fixtures" tabindex="-1"><a class="header-anchor" href="#creer-de-fausses-donnees-fixtures"><span>Cr√©er de fausses donn√©es (fixtures)</span></a></h2><div style="position:relative;padding-bottom:56.25%;height:0;"><iframe src="https://www.loom.com/embed/9cc4ebbdd27540fb8430c26130c778cd" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div><p>Pour tester notre application (surtout pour le d√©veloppement), nous pouvons ins√©rer des donn√©es de bases (souvent fausses). Pour cela, je vous conseille d&#39;utiliser le <a href="https://symfony.com/doc/current/bundles/DoctrineFixturesBundle/index.html" target="_blank" rel="noopener noreferrer">DoctrineFixturesBundle</a>.</p><p>Par d√©faut, l&#39;installation de ce bundle cr√©e un fichier <code>src/DataFixtures/AppFixtures.php</code>. Vous pouvez vous en servir pour cr√©er tout ou partie de vos fausses donn√©es. Personnellement, je vous conseille de supprimer ce fichier et d&#39;en cr√©er un par table que vous voulez remplir (un peu plus compliqu√©, mais plus propre et l√©ger √† relire).</p><p>Conservons notre exemple de blog, pour cr√©er 2 jeux de fixtures (fausses donn√©es). Il faut d&#39;abord choisir dans quel ordre nous allons faire l&#39;insertion. Dans notre cas (2 entit√©s), nous pouvons le faire aussi bien dans un sens que dans l&#39;autre. Je choisis de commencer par les tags, puis les articles :</p><p><code>src/DataFixtures/TagFixtures.php</code></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>DataFixtures</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Tag</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FixturesBundle<span class="token punctuation">\</span>Fixture</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Persistence<span class="token punctuation">\</span>ObjectManager</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">TagFixtures</span> <span class="token keyword">extends</span> <span class="token class-name">Fixture</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@inheritDoc</span></span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">load</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ObjectManager</span> <span class="token variable">$manager</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// C&#39;est dans cette m√©thode que nous allons cr√©er nos donn√©es</span></span>
<span class="line">        <span class="token comment">// et les sauvegarder avec l&#39;ObjetManager (un parent de EntityManager)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// Je veux utiliser des noms de tags qui sonnent un peu r√©els</span></span>
<span class="line">        <span class="token comment">// M√™me si j&#39;utilise des mots au hasard</span></span>
<span class="line">        <span class="token variable">$tagNames</span> <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;informatiques&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;chiens&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;navigateurs&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;statistiques&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;promenades&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;archerie&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$tagNames</span> <span class="token keyword">as</span> <span class="token variable">$tagName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Je cr√©e des objets tags et les remplie</span></span>
<span class="line">            <span class="token comment">// avant d&#39;en demander l&#39;enregistrement √† l&#39;ObjectManager</span></span>
<span class="line">            <span class="token variable">$tag</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$tag</span><span class="token operator">-&gt;</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token variable">$tagName</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token variable">$manager</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// On sauvegarde effectivement tout en base</span></span>
<span class="line">        <span class="token variable">$manager</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>src/DataFixtures/ArticleFixtures.php</code></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>DataFixtures</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Article</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Repository<span class="token punctuation">\</span>TagRepository</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FixturesBundle<span class="token punctuation">\</span>Fixture</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Common<span class="token punctuation">\</span>DataFixtures<span class="token punctuation">\</span>DependentFixtureInterface</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>Persistence<span class="token punctuation">\</span>ObjectManager</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Impl√©menter DependentFixtureInterface permet au bundle de savoir</span></span>
<span class="line"><span class="token comment">// qu&#39;il va devoir charger d&#39;autres fixtures avant, ce qui va d√©finir </span></span>
<span class="line"><span class="token comment">// un ordre de priorit√©</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">TagFixtures</span> <span class="token keyword">extends</span> <span class="token class-name">Fixture</span> <span class="token keyword">implements</span> <span class="token class-name">DependentFixtureInterface</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@var</span> <span class="token class-name">TagRepository</span> </span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token variable">$tagRepository</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// Ici, on va se servir des tags qu&#39;on a d√©j√† ins√©r√© en base (pas obligatoire ;) )</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">TagRepository</span> <span class="token variable">$tagRepository</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tagRepository</span> <span class="token operator">=</span> <span class="token variable">$tagRepository</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@inheritDoc</span></span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">load</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ObjectManager</span> <span class="token variable">$manager</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// C&#39;est dans cette m√©thode que nous allons cr√©er nos donn√©es</span></span>
<span class="line">        <span class="token comment">// et les sauvegarder avec l&#39;ObjetManager (un parent de EntityManager)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// Les titres et contenus des articles va √™tre identiques, on les pr√©pare avant la boucle</span></span>
<span class="line">        </span>
<span class="line">        <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39; : Neque porro quisquam est qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit...&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce luctus neque justo, id vulputate velit malesuada in. Donec vulputate ipsum vitae orci vestibulum, et tempus orci hendrerit. Vestibulum mattis sit amet eros sodales accumsan. Proin auctor tellus vitae hendrerit viverra. Aliquam erat volutpat. Duis suscipit lacus tortor, non hendrerit sapien dapibus vel. Phasellus urna orci, porta vel arcu vitae, posuere efficitur diam. Phasellus convallis ante enim, a lobortis tortor fermentum et. Aenean hendrerit congue nulla quis interdum. Nullam quis magna sem. Duis quis pulvinar ante, ac posuere velit.&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// Pour les utiliser dans les articles, on r√©cup√®re la liste compl√®te de nos tags</span></span>
<span class="line">        <span class="token variable">$tags</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tagRepository</span><span class="token operator">-&gt;</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// On cr√©e une dizaine d&#39;articles</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$article</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$article</span><span class="token operator">-&gt;</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">.</span><span class="token variable">$title</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$article</span><span class="token operator">-&gt;</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// On r√©cup√®re un tag al√©atoire dans la liste $tags, qu&#39;on va associer √† notre article</span></span>
<span class="line">            <span class="token variable">$randomNumber</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$tags</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$article</span><span class="token operator">-&gt;</span><span class="token function">setTag</span><span class="token punctuation">(</span><span class="token variable">$tags</span><span class="token punctuation">[</span><span class="token variable">$randomNumber</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Si $randomNumber contient 0, on r√©cup√®re notre 1er tag</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// On pr√©pare l&#39;article √† l&#39;insertion en base</span></span>
<span class="line">            <span class="token variable">$manager</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// On sauvegarde effectivement tout en base</span></span>
<span class="line">        <span class="token variable">$manager</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Cette m√©thode sert √† dire au bundle quelles fixtures</span></span>
<span class="line">    <span class="token comment">// doivent √™tre appliqu√©es avant celles-ci</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token class-name static-context">TagFixtures</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Maintenant que nous avons nos jeux de (fausses) donn√©es, nous pouvons les appliquer avec la commande <code>php bin/console doctrine:fixtures:load</code>.</p><p>Par d√©faut, cette commande vide la base avant d&#39;ajouter les donn√©es. Si vous souhaitez ajouter des donn√©es √† la base existante, ajouter l&#39;option <code>--append</code> : <code>php bin/console doctrine:fixtures:load --append</code>.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Derni√®res mise √† jour : </span><!----></div><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/cours/symfony/23-injection.html" aria-label="Les services et l&#39;injection de d√©pendances"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Les services et l&#39;injection de d√©pendances</span></div></a><a class="route-link auto-link next" href="/cours/symfony/25-formulaires.html" aria-label="Formulaires"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Formulaires</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/cours/assets/app-BkblVdII.js" defer></script>
  </body>
</html>
