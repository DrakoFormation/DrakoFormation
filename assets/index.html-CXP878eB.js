import{aj as r,ak as p,al as s,am as n,ar as a,an as i,ao as c,ap as t,aq as u}from"./app-BkblVdII.js";const d="/cours/assets/ci-pipeline-overview-BbxT4WFH.png",m="data:image/png;base64,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",v="/cours/assets/ci-pipeline-mr2-B58D7n3O.png",b={};function k(h,e){const l=t("RouteLink"),o=t("VidStack");return u(),p("div",null,[e[3]||(e[3]=s('<h1 id="integration-continue" tabindex="-1"><a class="header-anchor" href="#integration-continue"><span>Int√©gration continue</span></a></h1><h2 id="pre-requis" tabindex="-1"><a class="header-anchor" href="#pre-requis"><span>Pr√©-requis</span></a></h2><ul><li><a href="https://git-scm.com/book/fr/v2" target="_blank" rel="noopener noreferrer">Git</a></li><li><a href="https://gitlab.com/" target="_blank" rel="noopener noreferrer">GitLab</a> / <a href="https://github.com/" target="_blank" rel="noopener noreferrer">GitHub</a> / <a href="https://bitbucket.org/" target="_blank" rel="noopener noreferrer">Bitbucket</a> / √©quivalent</li><li>Yaml (<a href="https://www.codeproject.com/Articles/1214409/Learn-YAML-in-five-minutes" target="_blank" rel="noopener noreferrer">apprendre le YAML en 5 minutes</a>)</li></ul><h2 id="definitions" tabindex="-1"><a class="header-anchor" href="#definitions"><span>D√©finitions</span></a></h2><p>L&#39;introduction en vid√©o :</p>',5)),e[4]||(e[4]=n("div",{style:{position:"relative","padding-bottom":"56.25%",height:"0"}},[n("iframe",{src:"https://www.loom.com/embed/85edd5f003384961baa88d784ef2ca9c",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}})],-1)),e[5]||(e[5]=s('<h3 id="devops" tabindex="-1"><a class="header-anchor" href="#devops"><span>DevOps</span></a></h3><p>Le DevOps est une pratique technique, visant √† unifier le d√©veloppement (logiciel) et l&#39;administration syst√®me (gestion des serveurs).</p><p>Dans les faits, on parle de DevOps √† la fois pour la pratique et comme m√©tier/sp√©cialisation. Dans les deux cas, il s&#39;agit de mettre en place divers outils, permettant de s&#39;assurer de la qualit√© du produit et du respect du cahier des charges au fur et √† mesure du d√©veloppement.</p><p>En pratique, cela implique :</p><ul><li>des cycles de d√©veloppement courts</li><li>un travail d&#39;√©quipe (relecture du code et mise en place de pratiques communes)</li><li>la mise en place, d√®s le d√©part, de tests, d&#39;outils de v√©rification de la qualit√© du code ou de la performance, etc. et leur automatisation</li><li>la mise en place d&#39;environnements de travail au plus pr√®s de l&#39;environnement de production (et lancement des outils automatis√©s dans ce contexte)</li><li>des mises √† disposition (d√©ploiement) tr√®s r√©guli√®res, que ce soit pour des tests ou en production</li><li>la surveillance du fonctionnement et de la qualit√© de la production par des m√©triques d√©finies au plus t√¥t.</li></ul><h3 id="deploiement-continu" tabindex="-1"><a class="header-anchor" href="#deploiement-continu"><span>D√©ploiement continu</span></a></h3><p>L&#39;id√©e du d√©ploiement continu est de livrer les nouvelles fonctionnalit√©s au client d√®s qu&#39;elles sont disponibles. Pour cela, on d√©ploie les modifications de mani√®re <strong>automatique</strong> d√®s leur validation (en g√©n√©ral par le client sur un autre environnement) ou leur fusion dans la branche principale.</p><p>On cherche ainsi √† am√©liorer l&#39;application en continu et cr√©er des cycles courts de d√©veloppement. Chaque d√©ploiement pouvant √™tre annul√© facilement (car peu de modification), on √©vite aussi l&#39;une des grandes contraintes des cycles longs.</p><h3 id="integration-continue-1" tabindex="-1"><a class="header-anchor" href="#integration-continue-1"><span>Int√©gration continue</span></a></h3><p>L&#39;int√©gration continue a pour but de v√©rifier chaque modification du code source, pour √©viter les r√©gressions et autres bugs (autant que possible). Un outil d&#39;int√©gration continue permet de lancer automatiquement diverses actions de v√©rification du projet (compilation, linters, test unitaires et fonctionnels, etc.) ou toute autre t√¢che automatisable (cf d√©ploiement continu üòâ ).</p><p>Pour utiliser des outils d&#39;int√©gration continue, il faut que :</p><ul><li>le code soit versionn√© (git, svn, etc.)</li><li>des outils de v√©rification automatiques existent dans le projet (compilation, tests, etc.)</li></ul><p>Si on souhaite mettre en place du d√©ploiement continu (avec ou sans int√©gration continue), il faut que :</p><ul><li>le projet puisse √™tre mis sur un serveur / sa machine de destination</li><li>des outils de d√©ploiement aient √©t√© mis en place</li></ul><h4 id="outils-d-integration-continue" tabindex="-1"><a class="header-anchor" href="#outils-d-integration-continue"><span>Outils d&#39;int√©gration continue</span></a></h4><ul><li><a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a></li><li><a href="https://travis-ci.com/" target="_blank" rel="noopener noreferrer">TravisCI</a></li><li><a href="http://cruisecontrol.sourceforge.net/" target="_blank" rel="noopener noreferrer">CruiseControl</a></li><li>mais aussi <a href="https://docs.github.com/en/actions" target="_blank" rel="noopener noreferrer">GitHub actions</a>, <a href="https://bitbucket.org/product/fr/features/pipelines" target="_blank" rel="noopener noreferrer">Bitbucket Pipelines</a> ou <a href="https://docs.gitlab.com/ee/ci/" target="_blank" rel="noopener noreferrer">GitLab CI</a></li></ul><p>Nous allons nous concentrer sur les <a href="https://docs.github.com/en/actions" target="_blank" rel="noopener noreferrer">GitHub actions</a> et <a href="https://docs.gitlab.com/ee/ci/" target="_blank" rel="noopener noreferrer">GitLab CI</a>, qui sont plut√¥t simples √† utiliser et plus rapides √† mettre en place (en plus d&#39;avoir une logique similaire).</p><h3 id="docker" tabindex="-1"><a class="header-anchor" href="#docker"><span>Docker</span></a></h3><p>Docker est un logiciel libre permettant de lancer des applications dans des conteneurs, ayant des t√¢ches sp√©cifiques (en g√©n√©ral, chaque conteneur permet de lancer 1 programme pr√©cis, avec ses d√©pendances directes).</p><p>Contrairement √† la virtualisation, qui reproduit toutes les caract√©ristiques d&#39;une machine, la conteneurisation s&#39;appuie sur certaines parties de la machine h√¥te (dont le syst√®me d&#39;exploitation) pour fonctionner (ce qui am√©liore grandement la compatibilit√© et la flexibilit√©). Un autre int√©r√™t est de s√©parer compl√®tement l&#39;ex√©cution des diff√©rents services n√©cessaires √† une application (BdD, serveur, etc.), les lan√ßant dans des processus s√©par√©s.</p>',20)),n("p",null,[e[1]||(e[1]=a("Pour plus d'informations sur le sujet, vous pouvez consulter ")),i(l,{to:"/docker/"},{default:c(()=>e[0]||(e[0]=[a("le cours sur Docker, sur ce site")])),_:1}),e[2]||(e[2]=a("."))]),e[6]||(e[6]=s('<h3 id="d-autres-outils-utiles" tabindex="-1"><a class="header-anchor" href="#d-autres-outils-utiles"><span>D&#39;autres outils utiles</span></a></h3><ul><li><a href="https://gitlab.com/xavki/sommaire-xavki-tutos-fr" target="_blank" rel="noopener noreferrer">Un grand ensemble de tuto DevOps par Xavki</a></li><li><a href="https://phpstan.org/" target="_blank" rel="noopener noreferrer">Un outil d&#39;analyse statique pour Php</a></li><li><a href="https://www.atlassian.com/fr/git/tutorials/comparing-workflows/gitflow-workflow" target="_blank" rel="noopener noreferrer">Git workflow</a></li><li><a href="https://docs.ansible.com/ansible/latest/index.html" target="_blank" rel="noopener noreferrer">Ansible</a> (automatisation de t√¢ches et gestion d&#39;√©tats)</li></ul><h2 id="gitlab-et-github" tabindex="-1"><a class="header-anchor" href="#gitlab-et-github"><span><a href="https://www.gitlab.com" target="_blank" rel="noopener noreferrer">GitLab</a> et <a href="https://www.github.com" target="_blank" rel="noopener noreferrer">GitHub</a></span></a></h2><p>Une pr√©sentation de GitLab et GitHub en vid√©o :</p>',4)),e[7]||(e[7]=n("div",{style:{position:"relative","padding-bottom":"56.25%",height:"0"}},[n("iframe",{src:"https://www.loom.com/embed/294683a858734af694d4b2edcb68d4c5",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}})],-1)),e[8]||(e[8]=s(`<p>Bien que tout ce qui suit s&#39;applique aussi bien √† Bitbucket, la syntaxe et les denominations changent d&#39;un outil √† l&#39;autre. Les concepts restent les m√™mes et il est plut√¥t ais√© d&#39;adapter ce que vous verrez ici √† d&#39;autres outils de CI/CD.</p><p>GitLab et GitHub sont des gestionnaires de repositories git en ligne. Ils peuvent servir, entre autre, de :</p><ul><li>gestionnaire de tickets</li><li>d&#39;outils de revue de code</li><li>plateforme de CI/CD</li></ul><p>Nous allons nous baser sur Git et ses m√©caniques, voici quelques resources pouvant √™tre utiles pour le ma√Ætriser :</p><ul><li><a href="https://about.gitlab.com/images/press/git-cheat-sheet.pdf" target="_blank" rel="noopener noreferrer">Git Cheat Sheet</a> (ou <a href="https://github.github.com/training-kit/downloads/fr/github-git-cheat-sheet.pdf" target="_blank" rel="noopener noreferrer">en Fran√ßais</a>)</li><li><a href="https://git-scm.com/docs" target="_blank" rel="noopener noreferrer">la documentation officielle</a></li><li>une <a href="https://www.atlassian.com/fr/git/tutorials/learn-git-with-bitbucket-cloud" target="_blank" rel="noopener noreferrer">documentation Bitbucket</a> assez compl√®te et en fran√ßais</li></ul><h3 id="revue-de-code" tabindex="-1"><a class="header-anchor" href="#revue-de-code"><span>Revue de code</span></a></h3><p>L&#39;un des grands int√©r√™ts de travailler avec Git (en plus d&#39;avoir un code versionn√©) est de faciliter le travail collaboratif, gr√¢ce notamment aux revues de code.</p><p>Mais <strong>pourquoi relire le code d&#39;un autre dev ?</strong></p><ul><li>V√©rifier que la demande initiale est respect√©e</li><li>Que le code produit r√©pond aux <strong>bonnes pratiques communes</strong></li><li>Avoir un second (ou troisi√®me, quatri√®me, etc.) point de vue sur le travail effectu√© et trouver d&#39;√©ventuels bugs avant qu&#39;ils ne se d√©voilent au client.</li></ul><p>Cette revue de code se fait en g√©n√©ral dans les Merge/Pull Requests (MR ou PR) du projet.</p><h2 id="ci-cd-avec-gitlab" tabindex="-1"><a class="header-anchor" href="#ci-cd-avec-gitlab"><span>CI / CD avec GitLab</span></a></h2><p>La <a href="https://docs.gitlab.com/ee/ci/introduction/index.html" target="_blank" rel="noopener noreferrer">documentation officielle de GitLab</a> √† laquelle je vais beaucoup me r√©f√©rer.</p><p>Pour se faire, notre principal outil va √™tre le fichier <code>.gitlab-ci.yml</code>. C&#39;est dans ce fichier que nous allons d√©finir nos t√¢ches (<code>jobs</code>) et nos √©tapes (<code>stages</code>).</p><ul><li>L&#39;ensemble des √©tapes forment ce qu&#39;on appelle un <code>Pipeline</code>.</li><li>Les √©tapes contiennent des t√¢ches. Ce sont des commandes (actions) que l&#39;on va faire lancer √† notre serveur (GitLab).</li><li>Les t√¢ches sont ex√©cut√©es par des <code>runners</code></li></ul><h3 id="un-exemple" tabindex="-1"><a class="header-anchor" href="#un-exemple"><span>Un exemple</span></a></h3><p>Un exemple de Workflow que nous pouvons construire :</p><p><img src="https://docs.gitlab.com/ee/ci/introduction/img/gitlab_workflow_example_11_9.png" alt="Un Workflow GitLab : depuis une nouvelle branche, on lance les actions automatiques jusqu&#39;au merge, qui d√©clenche d&#39;autres actions automatiques"></p><p>La version plus d√©taill√©e :</p><p><img src="https://docs.gitlab.com/ee/ci/introduction/img/gitlab_workflow_example_extended_v12_3.png" alt="Un Workflow GitLab : depuis une nouvelle branche, on lance les actions automatiques jusqu&#39;au merge, qui d√©clenche d&#39;autres actions automatiques"></p><p>Que se passe-t-il dans ces images :</p><ul><li>Un d√©veloppeur cr√©e une branche et cr√©e plusieurs changements (des commits)</li><li>D√®s que le serveur re√ßoit ses commits (push), un pipeline est lanc√© <ul><li>ce pipeline contient un ensemble d&#39;√©tapes (stages) qui doivent √™tre valid√©es pour passer √† la suivante</li><li>chaque √©tape d√©finit plusieurs t√¢ches √† ex√©cuter et, dans notre exemple, certaines t√¢ches cr√©ent une erreur</li></ul></li><li>Le pipeline renvoie une erreur</li><li>Le d√©veloppeur cr√©e plusieurs commits pour corriger les diff√©rents probl√®mes et les push</li><li>Un nouveau pipeline est lanc√©</li><li>Cette fois, tout fonctionne. L&#39;une des t√¢ches est le d√©ploiement d&#39;une Review App, c‚Äôest-√†-dire le d√©ploiement d&#39;un site permettant de tester la branche, dans des conditions r√©elles (tr√®s utile pour le reviewer de la Merge Request üòâ ).</li><li>Un(e) autre membre de l&#39;√©quipe relit et teste le code du d√©veloppeur et approuve sa Merge Request</li><li>La Merge Request est fusionn√©e</li><li>Un nouveau pipeline est lanc√© <ul><li>si le projet fait de la livraison continue (<em>Continuous Delivery</em>), une t√¢che peut √™tre lanc√©e (manuellement) pour mettre l&#39;application en production</li><li>si le projet fait du d√©ploiement continue (<em>Continuous Deployment</em>), cette t√¢che est lanc√©e automatiquement</li></ul></li></ul><h3 id="configuration-du-fichier-de-ci" tabindex="-1"><a class="header-anchor" href="#configuration-du-fichier-de-ci"><span>Configuration du fichier de CI</span></a></h3><p><a href="https://blog.eleven-labs.com/fr/introduction-gitlab-ci/" target="_blank" rel="noopener noreferrer">Mon pense-b√™te favori</a>, par Nicolas Gr√©vin de Eleven Labs</p><p>Son nom et son emplacement sont standard : <code>.gitlab-ci.yml</code> √† la racine du projet Sur GitLab, vous pouvez modifier cela dans : <code>Settings (menu de gauche) &gt; CI/CD &gt; General pipelines &gt; Custom CI config path</code></p><p>Toutefois, je vous conseille de garder la configuration de base, c&#39;est ce qui est attendu par beaucoup de d√©veloppeurs.</p><p>Un exemple de fichier <code>.gitlab-ci.yml</code> (celui utilis√© par ce site) :</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># Pour r√©aliser ce fichier, je me suis bas√© sur le tuto d&#39;Eleven Labs : </span></span>
<span class="line"><span class="token comment"># https://blog.eleven-labs.com/fr/introduction-gitlab-ci/</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># On d√©finit les diff√©rentes √©tapes (stages) √† faire tourner dans le pipeline</span></span>
<span class="line"><span class="token key atrule">stages</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># cette √©tape (stage) va compiler l&#39;application, </span></span>
<span class="line">  <span class="token comment"># permettant de v√©rifier qu&#39;il n&#39;y ait pas d&#39;erreur d√®s la compilation</span></span>
<span class="line">  <span class="token punctuation">-</span> build</span>
<span class="line">  <span class="token comment"># D√©ploie l&#39;application sur le serveur appropri√©, si n√©cessaire</span></span>
<span class="line">  <span class="token punctuation">-</span> deploy</span>
<span class="line"></span>
<span class="line"><span class="token comment"># On d√©finit une t√¢che (job) qui pourra √™tre lanc√©e lors d&#39;un stage</span></span>
<span class="line"><span class="token key atrule">pages</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># Ce job sera ex√©cut√© lors du stage build</span></span>
<span class="line">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build</span>
<span class="line">  <span class="token comment"># On va lancer ce job dans un container Docker. </span></span>
<span class="line">  <span class="token comment"># Ici, une image nodejs de chez Drakona, en version 14 (utilisant Alpine)</span></span>
<span class="line">  <span class="token key atrule">image</span><span class="token punctuation">:</span> drakona/node<span class="token punctuation">:</span>14<span class="token punctuation">-</span>alpine</span>
<span class="line">  <span class="token comment"># On met certains dossiers en cache, pour les conserver d&#39;une ex√©cution √† l&#39;autre</span></span>
<span class="line">  <span class="token key atrule">cache</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">paths</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># Ici, on garde le dossier node_modules, </span></span>
<span class="line">      <span class="token comment"># afin de ne pas re-t√©l√©charger toutes les d√©pendances √† chaque fois</span></span>
<span class="line">      <span class="token punctuation">-</span> node_modules/</span>
<span class="line">  <span class="token comment"># Le script que va utiliser ce job. Ici, on profite de notre Makefile !</span></span>
<span class="line">  <span class="token key atrule">script</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> make update build</span>
<span class="line">  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">paths</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> public</span>
<span class="line">  <span class="token comment"># Des tags pour d√©terminer quel runner va ex√©cuter la t√¢che.</span></span>
<span class="line">  <span class="token comment"># Ici, c&#39;est une configuration personnalis√©e, pour notre GitLab.</span></span>
<span class="line">  <span class="token comment"># Nous avons cr√©√© nos propres runners</span></span>
<span class="line">  <span class="token key atrule">tags</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Pour cette t√¢che, nous allons utiliser un runner utilisant Docker</span></span>
<span class="line">    <span class="token comment"># Dans notre cas, il y a 6 runners r√©pondant √† ce tag</span></span>
<span class="line">    <span class="token comment"># Et c&#39;est le premier disponible qui l&#39;ex√©cutera.</span></span>
<span class="line">    <span class="token punctuation">-</span> docker</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Un autre job, qui va d√©ployer notre application sur le serveur de prod</span></span>
<span class="line"><span class="token key atrule">deploy</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># Avant d&#39;ex√©cuter le script, on va faire un ensemble de commandes,</span></span>
<span class="line">  <span class="token comment"># pour avoir une cl√© SSH valide et pr√™te √† l&#39;emploi</span></span>
<span class="line">  <span class="token key atrule">before_script</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># On s&#39;assure que openssh est install√©</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token string">&#39;command -v ssh-agent &gt;/dev/null || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )&#39;</span></span>
<span class="line">    <span class="token comment"># On lance le client SSH</span></span>
<span class="line">    <span class="token punctuation">-</span> eval $(ssh<span class="token punctuation">-</span>agent <span class="token punctuation">-</span>s)</span>
<span class="line">    <span class="token comment"># On va chercher la variable d&#39;environnement DEPLOY_SK, d√©finie dans GitLab</span></span>
<span class="line">    <span class="token comment"># et qui contient une cl√© priv√©e que l&#39;on va utiliser pour le d√©ploiement</span></span>
<span class="line">    <span class="token punctuation">-</span> echo &quot;$DEPLOY_SK&quot; <span class="token punctuation">|</span> tr <span class="token punctuation">-</span>d &#39;\\r&#39; <span class="token punctuation">|</span> ssh<span class="token punctuation">-</span>add <span class="token punctuation">-</span></span>
<span class="line">    <span class="token comment"># On s&#39;assure d&#39;avoir un dossier .ssh et qu&#39;il ait des droits corrects</span></span>
<span class="line">    <span class="token punctuation">-</span> mkdir <span class="token punctuation">-</span>p ~/.ssh</span>
<span class="line">    <span class="token punctuation">-</span> chmod 700 ~/.ssh</span>
<span class="line">  <span class="token comment"># Ce job se lance lors du stage deploy</span></span>
<span class="line">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy</span>
<span class="line">  <span class="token comment"># Le script √† ex√©cuter</span></span>
<span class="line">  <span class="token key atrule">script</span><span class="token punctuation">:</span> make deploy</span>
<span class="line">  <span class="token comment"># Ce d√©ploiement n&#39;a lieu que si l&#39;on fait une action sur main </span></span>
<span class="line">  <span class="token comment"># (commit, push, merge, etc.)</span></span>
<span class="line">  <span class="token key atrule">only</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> main</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pipelines" tabindex="-1"><a class="header-anchor" href="#pipelines"><span>Pipelines</span></a></h3><p>Par d√©faut, un pipeline est lanc√© d√®s qu&#39;un nouveau commit est pouss√© (push) sur GitLab (si vous en poussez plusieurs dans la m√™me branche, un seul pipeline sera lanc√©, sur le dernier commit).</p><p>Vous pouvez voir les pipelines directement dans la partie <code>CI/CD</code> de votre repository, mais ils sont plus pratiques √† d&#39;autres emplacements de l&#39;interface.</p><p>Sur la partie <code>Project Overview</code> :</p><p><img src="`+d+'" alt=""></p><p>Sur la liste des Merge Requests :</p><p><img src="'+m+'" alt=""></p><p>Ou sur une <code>Merge Request</code> :</p><p><img src="'+v+`" alt=""></p><p>C&#39;est sur ce dernier affichage que vous pouvez avoir l&#39;adresse pour une <a href="https://docs.gitlab.com/ee/ci/review_apps/" target="_blank" rel="noopener noreferrer">Review App</a>, qui est le lien entre une branche de votre repository et un <a href="https://docs.gitlab.com/ee/ci/environments/index.html" target="_blank" rel="noopener noreferrer">environnement</a> (un serveur permettant de tester cette branche, en somme).</p><p><a href="https://docs.gitlab.com/ee/ci/review_apps/" target="_blank" rel="noopener noreferrer">La documentation officielle sur les Review App</a> et <a href="https://docs.gitlab.com/ee/ci/environments/index.html" target="_blank" rel="noopener noreferrer">celle sur les environnements</a></p><h3 id="les-runners" tabindex="-1"><a class="header-anchor" href="#les-runners"><span>Les runners</span></a></h3><p>Pour lancer les t√¢ches, GitLab utilise des programmes ind√©pendants, les <code>runners</code>. GitLab fourni de nombreux runners et vous permet √©ventuellement d&#39;en cr√©er vous-m√™me, en quelques lignes de commande.</p><p>Il y a 4 grands types de runners, disponibles par d√©faut :</p><ul><li>shell (la ligne de commande du serveur)</li><li>ssh (on ex√©cute nos commandes <em>via</em> SSH sur un autre serveur)</li><li>docker (on ex√©cute nos commandes dans un container Docker)</li><li>Kubernetes (on ex√©cute nos commandes dans un environnement Kubernetes)</li></ul><p>‚ö†Ô∏è Conseil gitlab.com : toujours utiliser docker (avec le tag <code>gitlab-org-docker</code> et une image Docker sur vos t√¢ches, √† moins que vous ne codiez en Ruby üòâ ).</p><h3 id="taches-jobs" tabindex="-1"><a class="header-anchor" href="#taches-jobs"><span>T√¢ches / jobs</span></a></h3><p>Une t√¢che doit toujours lancer un ou des scripts (commandes √† ex√©cuter), tout le reste est optionnel. De nombreuses options permettent de personnaliser les conditions de lancement de la t√¢che, les pr√©-requis, etc. Les diff√©rentes options des t√¢ches :</p><ul><li>script : d√©claration obligatoire, contenant les commandes √† ex√©cuter</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">pages</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">script</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> make update</span>
<span class="line">    <span class="token punctuation">-</span> make build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>before_script ou after_script : permet d&#39;ex√©cuter une ou des commandes avant ou apr√®s le script de notre t√¢che. Vous pouvez √©galement les d√©finir pour toutes vos t√¢ches, en les pr√©cisant √† la racine</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">before_script</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> echo &quot;avant tous les scripts<span class="token punctuation">,</span> sauf si un before script est d√©fini dans une t√¢che&quot;</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">pages</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">before_script</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> echo &quot;avant script&quot;</span>
<span class="line">  <span class="token key atrule">script</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> make update</span>
<span class="line">    <span class="token punctuation">-</span> make build</span>
<span class="line">  <span class="token key atrule">after_script</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> echo &quot;apr√®s script&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>image : nom d&#39;une image Docker √† utiliser pour ex√©cuter la t√¢che. Peut √™tre √©crit √† la racine pour l&#39;ex√©cution de toutes les t√¢ches.</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># toutes les t√¢ches seront ex√©cut√©es dans des conteneurs nodejs, en version 12</span></span>
<span class="line"><span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">12</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">pages</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># Cette t√¢che sera ex√©cut√©e dans un conteneur php-fpm</span></span>
<span class="line">  <span class="token key atrule">image</span><span class="token punctuation">:</span> php<span class="token punctuation">:</span>fpm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>services : permet d&#39;ajouter des conteneurs Docker pour aider dans les t√¢ches (associer une BdD par exemple)</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">pages</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">image</span><span class="token punctuation">:</span> php<span class="token punctuation">:</span>fpm</span>
<span class="line">  <span class="token comment"># On appelle le service postgres pour acc√©der √† une BdD</span></span>
<span class="line">  <span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> postgres</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>stages : permet de regrouper les t√¢ches dans des √©tapes :</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># D√©claration des diff√©rentes √©tapes disponibles</span></span>
<span class="line"><span class="token key atrule">stages</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> build</span>
<span class="line">  <span class="token punctuation">-</span> deploy</span>
<span class="line">  </span>
<span class="line"><span class="token key atrule">pages</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># la t√¢che pages est dans l&#39;√©tape build</span></span>
<span class="line">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build</span>
<span class="line"><span class="token comment">#...</span></span>
<span class="line"><span class="token key atrule">deploy</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># la t√¢che deploy est dans l&#39;√©tape deploy</span></span>
<span class="line">  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>only et except : d√©finition de contraintes d&#39;ex√©cution d&#39;une t√¢che. <code>only</code> peut, par exemple, pr√©ciser qu&#39;on ne lancera la t√¢che que lors d&#39;un <em>push sur master</em>, <code>except</code> que si le push √† lieu sur <em>une branche autre que master</em></li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">deploy-master</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">script</span><span class="token punctuation">:</span> make deploy</span>
<span class="line">  <span class="token key atrule">only</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> master <span class="token comment"># Le job sera effectu√© uniquement lors d‚Äôun √©v√©nement sur la branche master</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">test-not-master</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">script</span><span class="token punctuation">:</span> make test</span>
<span class="line">  <span class="token key atrule">except</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> master <span class="token comment"># Le job sera effectu√© sur toutes les branches lors d‚Äôun √©v√©nement sauf sur la branche master</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>cache : Mettre des fichiers et des r√©pertoires en cache et qui seront disponible dans le pipeline (ils sont d√©truits apr√®s l&#39;ex√©cution du pipeline, que ce soit un succ√®s ou non)</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">push-cache</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">script</span><span class="token punctuation">:</span> make cache</span>
<span class="line">  <span class="token key atrule">cache</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Chemin des fichiers et dossiers √† conserver</span></span>
<span class="line">    <span class="token key atrule">paths</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> cache <span class="token comment"># r√©pertoire mis en cache</span></span>
<span class="line">    <span class="token key atrule">policy</span><span class="token punctuation">:</span> push <span class="token comment"># On pr√©cise qu&#39;on ajoute au cache</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">pull-cache</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">script</span><span class="token punctuation">:</span> make somethingWithCache</span>
<span class="line">  <span class="token key atrule">cache</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">paths</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> build</span>
<span class="line">    <span class="token key atrule">policy</span><span class="token punctuation">:</span> pull <span class="token comment"># r√©cup√©ration du dossier build dans le cache</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Et beaucoup d&#39;autres, que je vous invite <a href="https://blog.eleven-labs.com/fr/introduction-gitlab-ci/" target="_blank" rel="noopener noreferrer">√† d√©couvrir ici</a> üòâ</p><h2 id="ci-cd-avec-github" tabindex="-1"><a class="header-anchor" href="#ci-cd-avec-github"><span>CI / CD avec GitHub</span></a></h2><p>L&#39;<a href="https://docs.github.com/en/actions/learn-github-actions" target="_blank" rel="noopener noreferrer">introduction officielle aux GitHub Actions</a>, et la vid√©o qui va avec :</p>`,62)),i(o,{src:"youtube/cP0I9w2coGU"}),e[9]||(e[9]=n("p",null,[a("‚ö†Ô∏è L'utilisation de GitHub Actions est limit√©e et d√©pend de votre abonnement √† GitHub (pour les projets professionnels d'envergure, un abonnement peut √™tre n√©cessaire, mais pas pour les projets personnels, normalement). Voir "),n("a",{href:"https://docs.github.com/en/actions/reference/usage-limits-billing-and-administration#about-billing-for-github-actions",target:"_blank",rel:"noopener noreferrer"},"la documentation officielle sur les limitations de GitHub Actions selon votre abonnement"),a(".")],-1)),e[10]||(e[10]=n("h3",{id:"un-workflow-basique",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#un-workflow-basique"},[n("span",null,"Un Workflow basique")])],-1)),e[11]||(e[11]=n("p",null,"Un premier parcours en vid√©o de la doc pour expliquer les diff√©rents termes et le fonctionnement global de GitHub Actions :",-1)),e[12]||(e[12]=n("div",{style:{position:"relative","padding-bottom":"56.25%",height:"0"}},[n("iframe",{src:"https://www.loom.com/embed/ef665b2420ad4446bb0955772748497a",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}})],-1)),e[13]||(e[13]=s(`<p>Avec GitHub, on ne parle plus de Pipelines, mais d&#39;Actions. Tout comme avec GitLab, GitHub Actions permet d&#39;ex√©cuter un ensemble de t√¢ches quand un √©v√©nement se produit sur le repository (distant). Le lexique est toutefois assez diff√©rent et il vaut mieux √©viter de m√©langer.</p><ul><li>Un <strong>Workflow</strong> est une proc√©dure automatique, d√©crivant les diff√©rents Jobs qui vont √™tre lanc√©s quand un Event se produit,</li><li>un <strong>Event</strong> (push sur le repository, par exemple) on d√©clenche un ou plusieurs Jobs,</li><li>un <strong>Job</strong> contient des Steps,</li><li>une <strong>Step</strong> contient des actions,</li><li>une <strong>Action</strong> est un script (une commande) √† ex√©cuter.</li></ul><p>Les Jobs sont ex√©cut√©s par des <strong>runners</strong> (et peuvent √™tre diff√©rents pour chaque Job). Un <strong>runner</strong> lance les diff√©rentes actions sur une machine virtuelle (Ubuntu Linux, Microsoft Windows ou macOS). Il est √©galement possible d&#39;utiliser Docker pour lancer nos actions (et nous n&#39;utiliserons que des images officielles).</p><p><img src="https://docs.github.com/assets/images/help/images/overview-actions-design.png" alt="Un r√©sum√© des composants des Actions GitHub"></p><p>Pour mettre en place des Workflows, il faut cr√©er un ensemble de fichiers <code>.yml</code> dans le dossier <code>.github/workflows/</code> du projet (en local, donc üòâ ). Ces fichiers peuvent √™tre nomm√© assez librement, mais leur nom doit √™tre toujours en minuscule, et on remplace les espaces par des tirets <code>-</code>.</p><p>La documentation propose de cr√©er le fichier <code>.github/workflows/learn-github-actions.yml</code>, contenant le code suivant (voir les commentaires pour le d√©tail). Cette commande cr√©e et pr√©pare un environnement nodejs et ex√©cute la commande <code>bats -v</code></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># On donne un nom √† notre Workflow (optionnel). C&#39;est ce nom qui apparaitra sur GitHub</span></span>
<span class="line"><span class="token key atrule">name</span><span class="token punctuation">:</span> learn<span class="token punctuation">-</span>github<span class="token punctuation">-</span>actions</span>
<span class="line"><span class="token comment"># On donne une liste d&#39;√©v√©nements pour le d√©clencher</span></span>
<span class="line"><span class="token comment"># Ici, d√®s qu&#39;on push sur le repo distant</span></span>
<span class="line"><span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># On liste les Jobs √† effectuer</span></span>
<span class="line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># On a un seul job : check-bats-version qui va pr√©parer un projet nodejs </span></span>
<span class="line">    <span class="token comment"># et ex√©cuter une commande</span></span>
<span class="line">    <span class="token key atrule">check-bats-version</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># Ce job est ex√©cut√© dans une machine virtuelle Ubuntu</span></span>
<span class="line">        <span class="token comment"># Dans sa derni√®re version.</span></span>
<span class="line">        <span class="token comment"># Pour l&#39;ex√©cuter dans une version pr√©cise (disons 19.04), il aurait fallu √©crire</span></span>
<span class="line">        <span class="token comment"># runs-on: ubuntu-19.04</span></span>
<span class="line">        <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</span>
<span class="line">        <span class="token comment"># On d√©finit les steps (la liste des actions) √† ex√©cuter</span></span>
<span class="line">        <span class="token key atrule">steps</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># On appelle une action d√©j√† d√©finie par la communaut√© (noter le mot-cl√© uses)</span></span>
<span class="line">            <span class="token comment"># Ici, c&#39;est une action qui va r√©cup√©rer le code (via git clone, a priori) et nous mettre sur la bonne branche</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2</span>
<span class="line">            <span class="token comment"># Une action pour pr√©parer un environnement nodejs</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v2</span>
<span class="line">                <span class="token comment"># Avec un param√®tre sp√©cifique : on veut la version 14 de nodejs</span></span>
<span class="line">                <span class="token key atrule">with</span><span class="token punctuation">:</span></span>
<span class="line">                  <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">&#39;14&#39;</span></span>
<span class="line">            <span class="token comment"># On lance une commande (run) pour installer la librairie bats</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token punctuation">-</span>g bats</span>
<span class="line">            <span class="token comment"># On lance la commande </span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> bats <span class="token punctuation">-</span>v</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Il est int√©ressant de noter, dans l&#39;exemple ce-dessus, l&#39;usage des mots-cl√©s <code>uses</code> et <code>run</code> :</p><ul><li><a href="https://docs.github.com/en/actions/learn-github-actions/finding-and-customizing-actions" target="_blank" rel="noopener noreferrer"><code>uses</code> va utiliser un autre fichier, d√©finit par la communaut√©</a> (disponible dans les actions de <em>tous</em> les projets) ou par vous-m√™mes (voir plus bas), pour ex√©cuter une ou plusieurs commandes (avec d&#39;√©ventuels param√®tres)</li><li><code>run</code> va ex√©cuter une commande directement</li></ul><p>Sachez qu&#39;il est √©galement possible d&#39;√©crire ses propres actions. N&#39;√©tant pas expert dans leur √©criture, je vous renvoie √† <a href="https://docs.github.com/en/actions/creating-actions" target="_blank" rel="noopener noreferrer">la documentation officielle pour la cr√©ation d&#39;actions</a></p><p>Exemple, en vid√©o, de mise en place d&#39;un premier Workflow sur un projet Symfony :</p>`,11)),e[14]||(e[14]=n("div",{style:{position:"relative","padding-bottom":"56.25%",height:"0"}},[n("iframe",{src:"https://www.loom.com/embed/7f140c95606e44d1b68c35f7aaceddf2",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}})],-1)),e[15]||(e[15]=s(`<h3 id="utiliser-des-conteneurs-docker" tabindex="-1"><a class="header-anchor" href="#utiliser-des-conteneurs-docker"><span>Utiliser des conteneurs Docker</span></a></h3><p>Il est possible de d√©finir des conteneurs pour ex√©cuter utiliser des services suppl√©mentaires dans les actions ou directement pour ex√©cuter les actions elles-m√™mes. Les images √† utiliser et leurs configurations sont d√©finies au niveau du Job. Le but est ici d&#39;ajouter un ensemble de programmes suppl√©mentaires, non pr√©sent par d√©faut dans la machine virtuelle Ubuntu, pour ex√©cuter certaines t√¢ches</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">container-job</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># On conserve une machine virtuelle de base</span></span>
<span class="line">    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Optionnel : on utilise un conteneur cr√©√© √† partir d&#39;une image php officielle, </span></span>
<span class="line">    <span class="token comment"># en version 7.4.9. </span></span>
<span class="line">    <span class="token comment"># Les actions du Job vont √™tre ex√©cut√©es dans ce conteneur</span></span>
<span class="line">    <span class="token key atrule">container</span><span class="token punctuation">:</span> php<span class="token punctuation">:</span>7.4.9</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># On fait appel √† un ou des services suppl√©mentaires, </span></span>
<span class="line">    <span class="token comment"># qui vont √™tre lanc√©s dans des conteneurs</span></span>
<span class="line">    <span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># On donne un nom √† notre service, qu&#39;on utilise dans notre .env </span></span>
<span class="line">      <span class="token comment"># (c&#39;est l&#39;adresse de la BdD)</span></span>
<span class="line">      <span class="token key atrule">db</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># On va utiliser l&#39;image mysql (image officielle) en version 5.7</span></span>
<span class="line">        <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span></span>
<span class="line">        <span class="token comment"># On passe des variables d&#39;environnement, pour configurer notre conteneur</span></span>
<span class="line">        <span class="token key atrule">env</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> pass</span>
<span class="line">          <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> test</span>
<span class="line"></span>
<span class="line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># ... On ex√©cute plusieurs √©tapes n√©cessaires</span></span>
<span class="line">      </span>
<span class="line">      <span class="token comment"># On ex√©cute une action pour, par exemple, mettre √† jour la BdD</span></span>
<span class="line">      <span class="token comment"># Attention, notre fichier .env doit avec les bonnes valeurs</span></span>
<span class="line">      <span class="token comment"># Utilisateur : root</span></span>
<span class="line">      <span class="token comment"># Mot de passe : pass</span></span>
<span class="line">      <span class="token comment"># Adresse/IP du serveur : db</span></span>
<span class="line">      <span class="token comment"># Nom de la base : test</span></span>
<span class="line">      <span class="token comment"># </span></span>
<span class="line">      <span class="token comment"># /!\\ Mettre √† jour ces √©l√©ments (dans le CI ou le .env) pour adapter √† votre cas !</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Create DB</span>
<span class="line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> php bin/console doctrine<span class="token punctuation">:</span>migrations<span class="token punctuation">:</span>migrate <span class="token punctuation">-</span>n</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>‚ö†Ô∏è Vous pouvez √©galement <a href="https://docs.github.com/en/actions/creating-actions/dockerfile-support-for-github-actions" target="_blank" rel="noopener noreferrer">cr√©er vos propres images Docker, mais il faut faire attention √† plusieurs points</a> importants !</p><h3 id="partager-des-fichiers" tabindex="-1"><a class="header-anchor" href="#partager-des-fichiers"><span>Partager des fichiers</span></a></h3><p>Il est possible, au fur et √† mesure de l&#39;ex√©cution de votre Workflow, qu&#39;il faille partager des fichiers, soit entre les jobs, soit en tant que r√©sultat (cr√©ation d&#39;un fichier <code>.jar</code> par exemple). Il est alors possible de <a href="https://docs.github.com/en/actions/guides/storing-workflow-data-as-artifacts" target="_blank" rel="noopener noreferrer">cr√©er des <strong>artifacts</strong></a> (nom donn√© aux fichiers cr√©√©s pendant le Workflow), associ√©s √† une ex√©cution de votre Workflow et partag√© entre plusieurs jobs (voir plusieurs ex√©cutions de votre Workflow !).</p><p>Pour sauvegarder, on utilise <code>actions/upload-artifact</code> (dans sa version 2, dans l&#39;exemple ci-dessous), qui permet de stocker un fichier sur GitHub</p><p>Pour r√©cup√©rer cette sauvegarde, on utilise <code>actions/download-artifact</code> (dans sa version 2, dans l&#39;exemple ci-dessous), qui permet de r√©cup√©rer des fichiers stock√©s sur GitHub</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">example-job-with-save</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> Save output</span>
<span class="line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># On lance une commande, qui sauvegarde son r√©sultat dans un fichier</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">shell</span><span class="token punctuation">:</span> bash</span>
<span class="line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">          expr 1 + 1 &gt; output.log</span></span>
<span class="line">      <span class="token comment"># On savegarde ce fichier sur GitHub, en tant qu&#39;artifact</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Upload output file</span>
<span class="line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/upload<span class="token punctuation">-</span>artifact@v2</span>
<span class="line">        <span class="token key atrule">with</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token comment"># On donne un nom √† notre artifact</span></span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> output<span class="token punctuation">-</span>log<span class="token punctuation">-</span>file</span>
<span class="line">          <span class="token comment"># Et un ensemble de fichiers qu&#39;il contient (utiliser Glob ici)</span></span>
<span class="line">          <span class="token key atrule">path</span><span class="token punctuation">:</span> output.log</span>
<span class="line">          </span>
<span class="line">  <span class="token key atrule">example-job-with-download</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># On va r√©cup√©rer un artifact, pour peut √™tre s&#39;en servir plus tard</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Download a single artifact</span>
<span class="line">        <span class="token key atrule">needs</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>job<span class="token punctuation">-</span>with<span class="token punctuation">-</span>save</span>
<span class="line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/download<span class="token punctuation">-</span>artifact@v2</span>
<span class="line">        <span class="token key atrule">with</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token comment"># On r√©cup√®re les fichiers par le nom de l&#39;artifact</span></span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> output<span class="token punctuation">-</span>log<span class="token punctuation">-</span>file</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>‚ö†Ô∏è Noter <a href="https://docs.github.com/en/actions/learn-github-actions/managing-complex-workflows#creating-dependent-jobs" target="_blank" rel="noopener noreferrer">l&#39;utilisation du mot-cl√© <code>needs</code></a> pour pr√©ciser que le deuxi√®me job a <em>besoin</em> que le premier ait termin√© son travail. Ce mot-cl√© est tr√®s utile, du moment que vous avez plusieurs jobs, surtout s&#39;ils d√©pendent les uns des autres.</p><h3 id="aller-plus-loin" tabindex="-1"><a class="header-anchor" href="#aller-plus-loin"><span>Aller plus loin</span></a></h3><p>Nous avons ici effleur√© la surface de tout ce qu&#39;il est possible de faire avec les GitHub Actions et je vous invite √† <a href="https://docs.github.com/en/actions" target="_blank" rel="noopener noreferrer">consulter la documentation officielle pour vous faire une id√©e de toutes les possibilit√©s</a> qu&#39;offre cet outil !</p><h2 id="exercice-ci-de-notre-projet-symfony" tabindex="-1"><a class="header-anchor" href="#exercice-ci-de-notre-projet-symfony"><span>Exercice - CI de notre projet Symfony</span></a></h2><p>Pour notre application Symfony, nous allons cr√©er un Workflow / pipeline pour installer et tester le projet. Nous ajouterons ensuite des outils suppl√©mentaires, que nous ajouterons √† notre int√©gration continue.</p><h3 id="les-elements-necessaires-a-notre-ci" tabindex="-1"><a class="header-anchor" href="#les-elements-necessaires-a-notre-ci"><span>Les √©l√©ments n√©cessaires √† notre CI</span></a></h3><ul><li>R√©cup√©rer le code (automatique avec GitLab, requiert une Action avec GitHub)</li><li>Installer les d√©pendances du projet</li><li>Cr√©er et initialiser la BdD (migrations + fixtures)</li></ul><p>Si vous utilisez <strong>GitLab</strong> :</p><ul><li>D√©finissez les diff√©rentes √©tapes/stages et les fichiers qu&#39;elles doivent partager</li><li>d√©finissez et impl√©mentez les t√¢ches/jobs demand√©es</li></ul><p>Si vous utiliser <strong>GitHub</strong> :</p><ul><li>D√©finissez les diff√©rents jobs</li><li>D√©finissez les √©tapes et les actions √† effectuer</li><li>Appelez les actions pr√©-d√©finies ou cr√©ez-en si n√©cessaire</li></ul><h3 id="des-outils-a-integrer" tabindex="-1"><a class="header-anchor" href="#des-outils-a-integrer"><span>Des outils √† int√©grer</span></a></h3><p>Une fois que vous disposez d&#39;une int√©gration continue qui fonctionne, vous √™tes pr√™ts √† rendre votre code plus beau et d&#39;ajouter des outils de v√©rification suppl√©mentaire.</p><p>Je vous invite √† jeter un oeil √† <a href="https://dev.to/duboiss/symfony-ce-que-j-aurai-aime-savoir-plus-tot-eke" target="_blank" rel="noopener noreferrer">cet article regroupant quelques astuces pouvant √™tre utiles avec Symfony</a></p><ul><li><a href="https://github.com/FriendsOfPHP/PHP-CS-Fixer" target="_blank" rel="noopener noreferrer">Php CS Fixer</a> : outil de v√©rification de la <strong>forme</strong> du code (attention, on utilise les options <code>--dry-run --diff</code> pour seulement v√©rifier le code, pas le mettre √† jour)</li><li>Les linters de Symfony, pour v√©rifier nos fichiers de configuration et nos vues (mais aussi <a href="https://symfony.com/doc/current/translation/lint.html" target="_blank" rel="noopener noreferrer">nos fichiers de traduction</a>)</li><li><a href="https://github.com/phpstan/phpstan" target="_blank" rel="noopener noreferrer">PhpStan</a> et en particulier <a href="https://github.com/phpstan/phpstan-symfony" target="_blank" rel="noopener noreferrer">PhpStan Symfony</a> : outil d&#39;analyse statique, pour d√©tecter les incoh√©rences du code et trouver des probl√®mes avant qu&#39;ils ne se produisent. Un conseil : pour corriger les erreurs, commencer au niveau 1 et augmenter petit √† petit, jusqu&#39;au niveau 5. Au dela du niveau 5, les erreurs sont bien plus complexes et p√©nibles √† corriger, et vont bien plus loin de ce que vous avez vu de PHP ici.</li></ul><p>Quelques autres outils, pour les courageux üòâ :</p><ul><li><a href="https://grafikart.fr/tutoriels/makefile-953" target="_blank" rel="noopener noreferrer">Makefile</a></li><li><a href="https://symfony.com/doc/current/testing.html" target="_blank" rel="noopener noreferrer">PhpUnit</a> ou Selenium pour des tests unitaires et/ou fonctionnels (si vous en avez, sinon c&#39;est l&#39;occasion de tester üòâ )</li><li>Si votre projet utilise npm : <ul><li>lancer l&#39;installation des paquets</li><li>utiliser les commandes n√©cessaires au fonctionnement du projet (compilation des fichiers Sass, appel √† Webpack, etc.)</li></ul></li></ul><h2 id="exercice-ci-avec-gitlab" tabindex="-1"><a class="header-anchor" href="#exercice-ci-avec-gitlab"><span>Exercice - CI avec GitLab</span></a></h2><h3 id="utilisation-des-bases" tabindex="-1"><a class="header-anchor" href="#utilisation-des-bases"><span>Utilisation des bases</span></a></h3><p>Dans un premier temps, nous allons cr√©er une int√©gration continue fictive, avec des echos comme scripts.</p><p>Dans une nouvelle branche Git, construire un pipeline respectant les consignes suivantes (les scripts sont indiqu√©s entre parenth√®ses) :</p><ul><li><p>des t√¢ches</p><ul><li>composer (<code>echo &#39;composer install&#39;</code>)</li><li>database (<code>echo &quot;cr√©ation d&#39;une BdD et ex√©cution des migrations et fixtures&quot;</code>)</li><li>tests unitaires (<code>echo &#39;tests unitaires&#39;</code>)</li><li>tests fonctionnels (<code>echo &#39;tests fonctionnels&#39;</code>)</li><li>d√©ploiement prod (<code>echo &#39;d√©ploiement prod&#39;</code>), uniquement sur la branche main / master (votre branche principale) et √† d√©clencher manuellement (ne doit pas √™tre lanc√©e automatiquement)</li><li>d√©ploiement d√©mo (<code>echo &#39;d√©ploiement d√©mo&#39;</code>), uniquement sur la branche principale</li><li>d√©ploiement App Review (<code>echo &#39;d√©ploiement app review&#39;</code>), sur les branches autres que votre branche principale</li></ul></li><li><p>des √©tapes :</p><ul><li><code>build</code> qui contiendra les t√¢ches <code>composer</code> et <code>database</code></li><li><code>test</code> qui contiendra les t√¢ches de tests unitaires et fonctionnels</li><li><code>deploy</code> qui contiendra les t√¢ches de d√©ploiement (prod, d√©mo et App Review)</li></ul></li></ul><p>Pour tester votre pipeline, faites un push de cette branche üòâ .</p><p>Question suppl√©mentaire, n√©cessaire pour la suite : comment faire en sorte de ne pas avoir √† faire un <code>composer install</code> et de mettre en place la BdD pour chaque t√¢che ?</p><h3 id="ajout-de-docker" tabindex="-1"><a class="header-anchor" href="#ajout-de-docker"><span>Ajout de Docker</span></a></h3><p>Maintenant, nous allons mettre en place des scripts r√©els. Pour cela, nous allons √©galement utiliser 2 images Docker :</p><ul><li><p><code>drakona/php:7.4-symfony</code> en tant qu&#39;image pour toutes nos t√¢ches</p></li><li><p><code>mysql:5.7</code> en tant que service, pour obtenir une BdD</p></li><li><p>Comment configurer MySQL ? (voir documentation de l&#39;image mysql sur DockerHub)</p></li><li><p>Comment avoir la bonne configuration dans le fichier <code>.env</code> pendant le pipeline ?</p></li><li><p>Ajouter les scripts r√©els :</p><ul><li>la t√¢che <code>composer</code> doit lancer un <code>composer install</code></li><li>la t√¢che <code>database</code> doit lancer les migrations et les fixtures</li></ul></li></ul><p>Pour le moment, les autres t√¢ches vont continuer √† faire des <code>echo</code></p>`,37))])}const f=r(b,[["render",k],["__file","index.html.vue"]]),g=JSON.parse(`{"path":"/ci/","title":"Int√©gration continue","lang":"fr-FR","frontmatter":{"date":"2021-02-05T00:00:00.000Z"},"headers":[{"level":2,"title":"Pr√©-requis","slug":"pre-requis","link":"#pre-requis","children":[]},{"level":2,"title":"D√©finitions","slug":"definitions","link":"#definitions","children":[{"level":3,"title":"DevOps","slug":"devops","link":"#devops","children":[]},{"level":3,"title":"D√©ploiement continu","slug":"deploiement-continu","link":"#deploiement-continu","children":[]},{"level":3,"title":"Int√©gration continue","slug":"integration-continue-1","link":"#integration-continue-1","children":[]},{"level":3,"title":"Docker","slug":"docker","link":"#docker","children":[]},{"level":3,"title":"D'autres outils utiles","slug":"d-autres-outils-utiles","link":"#d-autres-outils-utiles","children":[]}]},{"level":2,"title":"GitLab et GitHub","slug":"gitlab-et-github","link":"#gitlab-et-github","children":[{"level":3,"title":"Revue de code","slug":"revue-de-code","link":"#revue-de-code","children":[]}]},{"level":2,"title":"CI / CD avec GitLab","slug":"ci-cd-avec-gitlab","link":"#ci-cd-avec-gitlab","children":[{"level":3,"title":"Un exemple","slug":"un-exemple","link":"#un-exemple","children":[]},{"level":3,"title":"Configuration du fichier de CI","slug":"configuration-du-fichier-de-ci","link":"#configuration-du-fichier-de-ci","children":[]},{"level":3,"title":"Pipelines","slug":"pipelines","link":"#pipelines","children":[]},{"level":3,"title":"Les runners","slug":"les-runners","link":"#les-runners","children":[]},{"level":3,"title":"T√¢ches / jobs","slug":"taches-jobs","link":"#taches-jobs","children":[]}]},{"level":2,"title":"CI / CD avec GitHub","slug":"ci-cd-avec-github","link":"#ci-cd-avec-github","children":[{"level":3,"title":"Un Workflow basique","slug":"un-workflow-basique","link":"#un-workflow-basique","children":[]},{"level":3,"title":"Utiliser des conteneurs Docker","slug":"utiliser-des-conteneurs-docker","link":"#utiliser-des-conteneurs-docker","children":[]},{"level":3,"title":"Partager des fichiers","slug":"partager-des-fichiers","link":"#partager-des-fichiers","children":[]},{"level":3,"title":"Aller plus loin","slug":"aller-plus-loin","link":"#aller-plus-loin","children":[]}]},{"level":2,"title":"Exercice - CI de notre projet Symfony","slug":"exercice-ci-de-notre-projet-symfony","link":"#exercice-ci-de-notre-projet-symfony","children":[{"level":3,"title":"Les √©l√©ments n√©cessaires √† notre CI","slug":"les-elements-necessaires-a-notre-ci","link":"#les-elements-necessaires-a-notre-ci","children":[]},{"level":3,"title":"Des outils √† int√©grer","slug":"des-outils-a-integrer","link":"#des-outils-a-integrer","children":[]}]},{"level":2,"title":"Exercice - CI avec GitLab","slug":"exercice-ci-avec-gitlab","link":"#exercice-ci-avec-gitlab","children":[{"level":3,"title":"Utilisation des bases","slug":"utilisation-des-bases","link":"#utilisation-des-bases","children":[]},{"level":3,"title":"Ajout de Docker","slug":"ajout-de-docker","link":"#ajout-de-docker","children":[]}]}],"git":{"updatedTime":1736283917000},"filePathRelative":"ci/README.md"}`);export{f as comp,g as data};
