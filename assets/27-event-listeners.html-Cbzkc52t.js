import{aj as o,ak as r,am as s,an as e,ao as p,al as l,ar as a,ap as i,aq as u}from"./app-BkblVdII.js";const d={},k={class:"table-of-contents"};function v(m,n){const t=i("router-link"),c=i("RouteLink");return u(),r("div",null,[n[11]||(n[11]=s("h1",{id:"event-listeners-subscribers",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#event-listeners-subscribers"},[s("span",null,"Event listeners/subscribers")])],-1)),s("nav",k,[s("ul",null,[s("li",null,[e(t,{to:"#pour-resumer"},{default:p(()=>n[0]||(n[0]=[a("Pour résumer")])),_:1})]),s("li",null,[e(t,{to:"#listener-ou-subscriber"},{default:p(()=>n[1]||(n[1]=[a("Listener ou subscriber ?")])),_:1}),s("ul",null,[s("li",null,[e(t,{to:"#que-choisir"},{default:p(()=>n[2]||(n[2]=[a("Que choisir ?")])),_:1})])])]),s("li",null,[e(t,{to:"#creer-un-subscriber"},{default:p(()=>n[3]||(n[3]=[a("Créer un subscriber")])),_:1})]),s("li",null,[e(t,{to:"#creer-nos-propres-evenements"},{default:p(()=>n[4]||(n[4]=[a("Créer nos propres événements")])),_:1})]),s("li",null,[e(t,{to:"#declencher-un-evenement-manuellement"},{default:p(()=>n[5]||(n[5]=[a("Déclencher un événement manuellement")])),_:1})])])]),n[12]||(n[12]=s("p",null,"En vidéo :",-1)),n[13]||(n[13]=s("div",{style:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{src:"https://www.loom.com/embed/01b83b1084b8486590cc03c05deb8392",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}})],-1)),n[14]||(n[14]=l(`<p>Les event listeners (ou écouteurs d&#39;événement) et les event subscribers (souscripteurs d&#39;événement) sont des services qui vont être appelés lorsqu&#39;un ou des événements précis sont déclenchés. Ils viennent compléter un fonctionnement existant.</p><h2 id="pour-resumer" tabindex="-1"><a class="header-anchor" href="#pour-resumer"><span>Pour résumer</span></a></h2><ul><li>Les Event Listeners et Event Subscribers sont des services (classes Php) et ont un comportement très similaire.</li><li>Les Event Listeners : <ul><li>permettent d&#39;écouter un événement (Event), défini par son nom (unique)</li><li>ont une méthode par Event écouté, de la forme <code>on</code> + nom de l&#39;Event en CamelCase (<code>onKernelException</code> pour un événement <code>kernel.exception</code>)</li><li>cette méthode prend en paramètre un objet Event, lié à l&#39;événement écouté</li><li>doit être déclaré avec un tag par event dans le fichier <code>config/services.yaml</code>.</li></ul></li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">App\\EventListener\\ExceptionListener</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">tags</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kernel.event_listener<span class="token punctuation">,</span> <span class="token key atrule">event</span><span class="token punctuation">:</span> kernel.exception <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Les Event Subscribers <ul><li>implémentent l&#39;interface <code>Symfony\\Component\\EventDispatcher\\EventSubscriberInterface</code></li><li>permettent d&#39;écouter un ou plusieurs événements (Event)</li><li>la méthode <code>getSubscribedEvents()</code> permet de faire le lien entre les événements écoutés (on peut écrire le FQCN de l&#39;événement ou le nom de l&#39;événement) et les méthodes à appeler pour chacun (avec d&#39;éventuelles priorités)</li><li>les méthodes ont des noms libres, mais les paramètres sont définis par l&#39;événement.</li></ul></li><li>Il est possible de créer nos propres événements en étendant <code>Symfony\\Contracts\\EventDispatcher\\Event</code>.</li><li>Ces événements doivent toujours avoir un nom <strong>unique</strong>.</li><li>On peut émettre un événement grâce au service <code>event_dispatcher</code> (depuis un controller) ou depuis le service <code>Symfony\\Contracts\\EventDispatcher\\EventDispatcherInterface</code>.</li></ul><h2 id="listener-ou-subscriber" tabindex="-1"><a class="header-anchor" href="#listener-ou-subscriber"><span>Listener ou subscriber ?</span></a></h2><p>Un listener est une classe liée à un ou plusieurs événements, mais qui n&#39;a pas conscience des événements écoutés (ils ne sont pas indiqués dans la classe). Un subscriber est une classe liée à un ou plusieurs événements et il est toujours aisé de savoir quel événement est appelé (ils sont indiqués dans la classe).</p><p>Une autre différence majeure est la mise en place : le listener oblige à créer une entrée dans <code>config/services.yaml</code>, alors que le subscriber n&#39;en a pas besoin.</p><p>Prenons un listener <code>src/EventListener/ExceptionListener.php</code> surveillant si une exception a été envoyée :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\\</span>EventListener</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\\</span>Component<span class="token punctuation">\\</span>HttpKernel<span class="token punctuation">\\</span>Event<span class="token punctuation">\\</span>ExceptionEvent</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ExceptionListener</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">onKernelException</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ExceptionEvent</span> <span class="token variable">$event</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ... Code à déclencher en cas d&#39;exception</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Il faudra l&#39;enregistrer dans <code>config/services.yaml</code> :</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">App\\EventListener\\ExceptionListener</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">tags</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kernel.event_listener<span class="token punctuation">,</span> <span class="token key atrule">event</span><span class="token punctuation">:</span> kernel.exception <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>⚠️ ce sont les tags qui sont importants ici. Vous pouvez injecter automatiquement d&#39;autres services dans celui-ci, malgré tout.</p><p>Un subscriber sera plutôt de cette forme :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\\</span>EventSubscriber</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\\</span>Component<span class="token punctuation">\\</span>EventDispatcher<span class="token punctuation">\\</span>EventSubscriberInterface</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\\</span>Component<span class="token punctuation">\\</span>HttpKernel<span class="token punctuation">\\</span>Event<span class="token punctuation">\\</span>ExceptionEvent</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\\</span>Component<span class="token punctuation">\\</span>HttpKernel<span class="token punctuation">\\</span>KernelEvents</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ExceptionSubscriber</span> <span class="token keyword">implements</span> <span class="token class-name">EventSubscriberInterface</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getSubscribedEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// retourne les événements souscrits, les méthodes associées et leurs priorités</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token comment">// On souscrit à l&#39;événement KernelEvents::EXCEPTION</span></span>
<span class="line">            <span class="token class-name static-context">KernelEvents</span><span class="token operator">::</span><span class="token constant">EXCEPTION</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token comment">// Les 3 méthodes ci-dessous seront appelées,</span></span>
<span class="line">                <span class="token comment">// le nombre (optionnel) permet de savoir l&#39;ordre d&#39;appel.</span></span>
<span class="line">                <span class="token comment">// Les méthodes associées au nombre le plus haut seront exécutées en premier,</span></span>
<span class="line">                <span class="token comment">// puis celles avec un nombre plus bas, etc.</span></span>
<span class="line">                <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;processException&#39;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;logException&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;notifyException&#39;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">processException</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ExceptionEvent</span> <span class="token variable">$event</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">logException</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ExceptionEvent</span> <span class="token variable">$event</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">notifyException</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ExceptionEvent</span> <span class="token variable">$event</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>⚠️ C&#39;est la méthode <code>getSubscribedEvents</code> qui définit quelle méthode est appelée pour quel événement et dans quel ordre. Il est donc très important de bien la comprendre.</p><h3 id="que-choisir" tabindex="-1"><a class="header-anchor" href="#que-choisir"><span>Que choisir ?</span></a></h3><p>Personnellement, j&#39;ai toujours utilisé des subscribers (autant que possible), le fonctionnement des deux types étant très proches. Ma préférence vient du fait que je préfère avoir toutes les informations dans une classe, plutôt que de devoir chercher sa configuration et le contenu de la classe pour comprendre le fonctionnement.</p><p>Il semble que les listeners soient plus souples et permettent aux bundles de plus facilement (dés)activer des listeners en fonction de la configuration. Il s&#39;agit en grande partie d&#39;un choix personnel, donc 😉 .</p><h2 id="creer-un-subscriber" tabindex="-1"><a class="header-anchor" href="#creer-un-subscriber"><span>Créer un subscriber</span></a></h2><p><a href="https://symfony.com/doc/current/doctrine/events.html" target="_blank" rel="noopener noreferrer">Les event listeners de Doctrine</a> sont un cas un peu particulier, et nous allons commencer par eux.</p>`,21)),s("p",null,[n[7]||(n[7]=a("Nous allons créer un event subscriber qui hash un mot de passe (")),e(c,{to:"/symfony/30-user.html"},{default:p(()=>n[6]||(n[6]=[a("voir partie suivante, sur le système de connexion")])),_:1}),n[8]||(n[8]=a(") lorsqu'on enregistre un objet ")),n[9]||(n[9]=s("code",null,"User",-1)),n[10]||(n[10]=a(". Nous en ferons ensuite un autre faisant la même opération, mais lors de l'enregistrement dans EasyAdmin. Les deux sont, bien sûr, redondant et sont présentés pour vous montrer les deux cas de figure."))]),n[15]||(n[15]=l(`<p>Créons un fichier <code>src/EventListener/HashPasswordSubscriber.php</code> :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\\</span>EventListener</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\\</span>Entity<span class="token punctuation">\\</span>User</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\\</span>Bundle<span class="token punctuation">\\</span>DoctrineBundle<span class="token punctuation">\\</span>EventSubscriber<span class="token punctuation">\\</span>EventSubscriberInterface</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\\</span>ORM<span class="token punctuation">\\</span>Events</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\\</span>Persistence<span class="token punctuation">\\</span>Event<span class="token punctuation">\\</span>LifecycleEventArgs</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\\</span>Component<span class="token punctuation">\\</span>PasswordHasher<span class="token punctuation">\\</span>Hasher<span class="token punctuation">\\</span>UserPasswordHasherInterface</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">HashPasswordSubscriber</span> <span class="token keyword">implements</span> <span class="token class-name">EventSubscriberInterface</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token class-name type-declaration">UserPasswordHasherInterface</span> <span class="token variable">$hasher</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// On injecte le service de hashage de mot de passe</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">UserPasswordHasherInterface</span> <span class="token variable">$hasher</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hasher</span> <span class="token operator">=</span> <span class="token variable">$hasher</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// Les event subscribers de Doctrine ont des méthodes figées</span></span>
<span class="line">    <span class="token comment">// et getSubscribedEvents() ne renvoie que les événements écoutés</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getSubscribedEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token class-name static-context">Events</span><span class="token operator">::</span><span class="token constant">prePersist</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token class-name static-context">Events</span><span class="token operator">::</span><span class="token constant">preUpdate</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// Cette méthode est automatiquement appelée lorsque l&#39;événement Events::prePersist est déclenché</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">prePersist</span><span class="token punctuation">(</span><span class="token class-name type-declaration">LifecycleEventArgs</span> <span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">hashPassword</span><span class="token punctuation">(</span><span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// Cette méthode est automatiquement appelée lorsque l&#39;événement Events::preUpdate est déclenché</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">preUpdate</span><span class="token punctuation">(</span><span class="token class-name type-declaration">LifecycleEventArgs</span> <span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">hashPassword</span><span class="token punctuation">(</span><span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">hashPassword</span><span class="token punctuation">(</span><span class="token class-name type-declaration">LifecycleEventArgs</span> <span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// On récupère l&#39;entité qui a déclenché l&#39;événement</span></span>
<span class="line">        <span class="token variable">$entity</span> <span class="token operator">=</span> <span class="token variable">$args</span><span class="token operator">-&gt;</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// Si ça n&#39;est pas un User ou si la propriété plainPassword est vide,</span></span>
<span class="line">        <span class="token comment">// On ne fait rien</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$entity</span> <span class="token keyword">instanceof</span> <span class="token class-name">User</span> <span class="token operator">||</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$entity</span><span class="token operator">-&gt;</span><span class="token function">getPlainPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// On définit le nouveau mot de passe, en hashant la propriété plainPassword (temporaire)</span></span>
<span class="line">        <span class="token variable">$entity</span><span class="token operator">-&gt;</span><span class="token function">setPassword</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">passwordHasher</span><span class="token operator">-&gt;</span><span class="token function">hashPassword</span><span class="token punctuation">(</span><span class="token variable">$entity</span><span class="token punctuation">,</span> <span class="token variable">$entity</span><span class="token operator">-&gt;</span><span class="token function">getPlainPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>La même chose, mais en se basant sur les événements de EasyAdmin (et donc uniquement dans ce contexte) :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\\</span>EventListener</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\\</span>Entity<span class="token punctuation">\\</span>User</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">EasyCorp<span class="token punctuation">\\</span>Bundle<span class="token punctuation">\\</span>EasyAdminBundle<span class="token punctuation">\\</span>Event<span class="token punctuation">\\</span>BeforeEntityPersistedEvent</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">EasyCorp<span class="token punctuation">\\</span>Bundle<span class="token punctuation">\\</span>EasyAdminBundle<span class="token punctuation">\\</span>Event<span class="token punctuation">\\</span>BeforeEntityUpdatedEvent</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\\</span>Component<span class="token punctuation">\\</span>EventDispatcher<span class="token punctuation">\\</span>EventSubscriberInterface</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\\</span>Component<span class="token punctuation">\\</span>PasswordHasher<span class="token punctuation">\\</span>Hasher<span class="token punctuation">\\</span>UserPasswordHasherInterface</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">AdminUserUpdateSubscriber</span> <span class="token keyword">implements</span> <span class="token class-name">EventSubscriberInterface</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token class-name type-declaration">UserPasswordHasherInterface</span> <span class="token variable">$hasher</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// On injecte le service de hashage de mot de passe</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">UserPasswordHasherInterface</span> <span class="token variable">$hasher</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hasher</span> <span class="token operator">=</span> <span class="token variable">$hasher</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// On définit quelle méthode appeler lors du déclenchement d&#39;un des événements</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getSubscribedEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Notez qu&#39;aucune priorité n&#39;est définie (c&#39;est le cas le plus courant, pour moi).</span></span>
<span class="line">        <span class="token comment">// Ceci est équivalent à une priorité de 0</span></span>
<span class="line">        <span class="token comment">// Notez également que l&#39;on utilise le FQCN des événement, et non une constante. Les deux fonctionnent ;)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token class-name static-context">BeforeEntityPersistedEvent</span><span class="token operator">::</span><span class="token keyword">class</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;updateUserPassword&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token class-name static-context">BeforeEntityUpdatedEvent</span><span class="token operator">::</span><span class="token keyword">class</span>   <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;updateUserPassword&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token class-name">BeforeEntityPersistedEvent<span class="token punctuation">|</span>BeforeEntityUpdatedEvent</span> <span class="token parameter">$event</span></span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">updateUserPassword</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$entity</span> <span class="token operator">=</span> <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token function">getEntityInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$entity</span> <span class="token keyword">instanceof</span> <span class="token class-name">User</span> <span class="token operator">||</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$entity</span><span class="token operator">-&gt;</span><span class="token function">getPlainPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// On définit le nouveau mot de passe, en hashant la propriété plainPassword (temporaire)</span></span>
<span class="line">        <span class="token variable">$entity</span><span class="token operator">-&gt;</span><span class="token function">setPassword</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">hasher</span><span class="token operator">-&gt;</span><span class="token function">hashPassword</span><span class="token punctuation">(</span><span class="token variable">$entity</span><span class="token punctuation">,</span> <span class="token variable">$entity</span><span class="token operator">-&gt;</span><span class="token function">getPlainPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="creer-nos-propres-evenements" tabindex="-1"><a class="header-anchor" href="#creer-nos-propres-evenements"><span>Créer nos propres événements</span></a></h2><p>La <a href="https://symfony.com/doc/current/components/event_dispatcher.html" target="_blank" rel="noopener noreferrer">documentation du composant EventDispatcher</a></p><p>Exemple de création d&#39;événements personnalisés, en vidéo :</p>`,7)),n[16]||(n[16]=s("div",{style:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{src:"https://www.loom.com/embed/71b2c1735f80442d95f0c16cdb12dad3",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}})],-1)),n[17]||(n[17]=l(`<p>Les événements sont représentés par un nom <strong>unique</strong> et sont lié à un objet d&#39;événement, qui sera transmis aux listeners, afin de fournir des informations supplémentaires.</p><p>Le nom de l&#39;événement doit suivre les conventions suivantes :</p><ul><li>il est en minuscule, ne peut contenir que des nombres, des points (<code>.</code>) ou des underscores (<code>_</code>)</li><li>il est toujours composé d&#39;au moins 2 mots, dont le premier représente un espace de nom et se sépare du mot suivant pas un point <code>.</code> (exemple <code>order.</code>)</li><li>le nom final est un verbe, indiquant l&#39;action qui a été produite (exemple <code>order.placed</code>)</li></ul><p>Pour des questions de rangement et de clarté, je vous recommande de définir ce nom dans une constante de classe, rangée dans un dossier <code>Event</code>. Un exemple pour un site de vente, pourrait être un fichier <code>src/Event/OrderEvents.php</code> (noter le pluriel) (⚠️ ce fichier n&#39;est pas obligatoire, vous pouvez également indiquer le nom de votre event directement dans l&#39;objet Event) :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\\</span>Event</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\\</span>Event<span class="token punctuation">\\</span>OrderStartedEvent</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\\</span>Event<span class="token punctuation">\\</span>OrderPlacedEvent</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">OrderEvents</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * Pour simplifier la completion par les IDE </span>
<span class="line">     * et se rappeler plus aisément l&#39;événement associé, </span>
<span class="line">     * on ajoute une annotation pour l&#39;indiquer</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Event</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;App\\Event\\OrderStartedEvent&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token constant">STARTED</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;order.started&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">Event</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;App\\Event\\OrderPlacedEvent&quot;</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token constant">PLACED</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;order.placed&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// On ajoute des aliases, qui peuvent être utilisés </span></span>
<span class="line">    <span class="token comment">// dans certains cas précis, pour lier events et noms</span></span>
<span class="line">    <span class="token comment">// (si vos events font partie d&#39;un bundle, par exemple)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token constant">ALIASES</span> <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token class-name static-context">OrderStartedEvent</span><span class="token operator">::</span><span class="token keyword">class</span> <span class="token operator">=&gt;</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">STARTED</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name static-context">OrderPlacedEvent</span><span class="token operator">::</span><span class="token keyword">class</span>  <span class="token operator">=&gt;</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">PLACED</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Le fichier <code>src/Event/OrderPlacedEvent.php</code> (noter le singulier) ressemblerait à ceci :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">namespace</span> <span class="token package">Symfony<span class="token punctuation">\\</span>Component<span class="token punctuation">\\</span>HttpKernel<span class="token punctuation">\\</span>Event</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\\</span>Entity<span class="token punctuation">\\</span>Order</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\\</span>Contracts<span class="token punctuation">\\</span>EventDispatcher<span class="token punctuation">\\</span>Event</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">OrderPlacedEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Event</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// On peut également indiquer le nom de l&#39;événement directement dans celui-ci</span></span>
<span class="line">    <span class="token comment">// Pour éviter de créer 2 classes</span></span>
<span class="line">    <span class="token comment">// public const NAME = &#39;order.placed&#39;;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name type-declaration">Order</span> <span class="token variable">$order</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Order</span> <span class="token variable">$order</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">order</span> <span class="token operator">=</span> <span class="token variable">$order</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Order</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">order</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Un Event Listener ou un Event Subscriber pourrait alors s&#39;enregistrer pour l&#39;un des événements présents dans <code>OrderEvents</code> et utiliser l&#39;objet <code>Order</code> contenu dans l&#39;événement pour ajouter un traitement (génération d&#39;un numéro de facture, envoi d&#39;un fichier <code>pdf</code>, etc.).</p><h2 id="declencher-un-evenement-manuellement" tabindex="-1"><a class="header-anchor" href="#declencher-un-evenement-manuellement"><span>Déclencher un événement manuellement</span></a></h2><p>Dans notre exemple précédent, nous avons créé un événement, mais n&#39;avions pas de moyen de le déclencher. Pour cela, nous allons utiliser le service <code>EventDispatcher</code> de Symfony pour le faire.</p><p>Depuis un controller, dans une action :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// On récupère le service event dispatcher</span></span>
<span class="line"><span class="token variable">$eventDispatcher</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;event_dispatcher&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// On crée un event, contenant les informations qui seront utiles au listener</span></span>
<span class="line"><span class="token variable">$event</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderPlacedEvent</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// On envoi l&#39;événement, qui sera rattrapé par des listeners</span></span>
<span class="line"><span class="token variable">$eventDispatcher</span><span class="token operator">-&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token punctuation">,</span> <span class="token class-name static-context">OrderEvents</span><span class="token operator">::</span><span class="token constant">STARTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Dans un service :</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// On injecte l&#39;event dispatcher dans notre service</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">EventDispatcherInterface</span> <span class="token variable">$dispatcher</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">dispatcher</span> <span class="token operator">=</span> <span class="token variable">$dispatcher</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">doSomethingWithAnOrder</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Order</span> <span class="token variable">$order</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// On crée un event, contenant les informations qui seront utiles au listener</span></span>
<span class="line">    <span class="token variable">$event</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderPlacedEvent</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// On envoi l&#39;événement, qui sera rattrapé par des listeners</span></span>
<span class="line">    <span class="token variable">$eventDispatcher</span><span class="token operator">-&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token punctuation">,</span> <span class="token class-name static-context">OrderEvents</span><span class="token operator">::</span><span class="token constant">STARTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14))])}const y=o(d,[["render",v],["__file","27-event-listeners.html.vue"]]),h=JSON.parse('{"path":"/symfony/27-event-listeners.html","title":"Event listeners/subscribers","lang":"fr-FR","frontmatter":{"date":"2021-12-01T00:00:00.000Z"},"headers":[{"level":2,"title":"Pour résumer","slug":"pour-resumer","link":"#pour-resumer","children":[]},{"level":2,"title":"Listener ou subscriber ?","slug":"listener-ou-subscriber","link":"#listener-ou-subscriber","children":[{"level":3,"title":"Que choisir ?","slug":"que-choisir","link":"#que-choisir","children":[]}]},{"level":2,"title":"Créer un subscriber","slug":"creer-un-subscriber","link":"#creer-un-subscriber","children":[]},{"level":2,"title":"Créer nos propres événements","slug":"creer-nos-propres-evenements","link":"#creer-nos-propres-evenements","children":[]},{"level":2,"title":"Déclencher un événement manuellement","slug":"declencher-un-evenement-manuellement","link":"#declencher-un-evenement-manuellement","children":[]}],"git":{"updatedTime":1736283917000},"filePathRelative":"symfony/27-event-listeners.md"}');export{y as comp,h as data};
